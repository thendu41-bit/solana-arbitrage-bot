var G=Object.create;var l=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames,M=Object.getOwnPropertySymbols,H=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var v=(r,t,e)=>t in r?l(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,L=(r,t)=>{for(var e in t||(t={}))N.call(t,e)&&v(r,e,t[e]);if(M)for(var e of M(t))J.call(t,e)&&v(r,e,t[e]);return r};var X=(r,t)=>{for(var e in t)l(r,e,{get:t[e],enumerable:!0})},D=(r,t,e,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of j(t))!N.call(r,s)&&s!==e&&l(r,s,{get:()=>t[s],enumerable:!(o=Y(t,s))||o.enumerable});return r};var Z=(r,t,e)=>(e=r!=null?G(H(r)):{},D(t||!r||!r.__esModule?l(e,"default",{value:r,enumerable:!0}):e,r)),$=r=>D(l({},"__esModule",{value:!0}),r);var te={};X(te,{initializeMarket:()=>z,makeCreateMarketInstruction:()=>ee});module.exports=$(te);var a=require("@solana/web3.js"),d=require("@solana/spl-token");var i={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};var Q=require("@solana/web3.js"),P=Z(require("bn.js"));var n=require("@solana/buffer-layout"),m=n.Layout,W=n.Structure;var S=n.UInt;var E=n.u16;var f=n.u32;var y=n.blob;var h=n.bits;var w=class extends m{constructor(e,o,s){super(e,s);this.blob=y(e),this.signed=o}decode(e,o=0){let s=new P.default(this.blob.decode(e,o),10,"le");return this.signed?s.fromTwos(this.span*8).clone():s}encode(e,o,s=0){return typeof e=="number"&&(e=new P.default(e)),this.signed&&(e=e.toTwos(this.span*8)),this.blob.encode(e.toArrayLike(Buffer,"le",this.span),o,s)}},x=class extends m{constructor(e){super(8,e);this._lower=h(f(),!1),this._upper=h(f(),!1)}addBoolean(e){this._lower.fields.length<32?this._lower.addBoolean(e):this._upper.addBoolean(e)}decode(e,o=0){let s=this._lower.decode(e,o),p=this._upper.decode(e,o+this._lower.span);return L(L({},s),p)}encode(e,o,s=0){return this._lower.encode(e,o,s)+this._upper.encode(e,o,s+this._lower.span)}};function k(r){return new S(1,r)}function O(r){return new S(4,r)}function u(r){return new w(8,!1,r)}var T=class extends m{constructor(e,o,s,p){super(e.span,p);this.layout=e,this.decoder=o,this.encoder=s}decode(e,o){return this.decoder(this.layout.decode(e,o))}encode(e,o,s){return this.layout.encode(this.encoder(e),o,s)}getSpan(e,o){return this.layout.getSpan(e,o)}};function c(r){return new T(y(32),t=>new Q.PublicKey(t),t=>t.toBuffer(),r)}var B=class extends W{decode(t,e){return super.decode(t,e)}};function g(r,t,e){return new B(r,t,e)}function I(r="accountFlags"){let t=new x(r);return t.addBoolean("initialized"),t.addBoolean("market"),t.addBoolean("openOrders"),t.addBoolean("requestQueue"),t.addBoolean("eventQueue"),t.addBoolean("bids"),t.addBoolean("asks"),t}var A=g([y(5),I("accountFlags"),c("ownAddress"),u("vaultSignerNonce"),c("baseMint"),c("quoteMint"),c("baseVault"),u("baseDepositsTotal"),u("baseFeesAccrued"),c("quoteVault"),u("quoteDepositsTotal"),u("quoteFeesAccrued"),u("quoteDustThreshold"),c("requestQueue"),c("eventQueue"),c("bids"),c("asks"),u("baseLotSize"),u("quoteLotSize"),u("feeRateBps"),u("referrerRebatesAccrued"),y(7)]);function z({programId:r,marketInfo:t}){let e=g([k("version"),O("instruction"),u("baseLotSize"),u("quoteLotSize"),E("feeRateBps"),u("vaultSignerNonce"),u("quoteDustThreshold")]),o=[{pubkey:t.id,isSigner:!1,isWritable:!0},{pubkey:t.requestQueue,isSigner:!1,isWritable:!0},{pubkey:t.eventQueue,isSigner:!1,isWritable:!0},{pubkey:t.bids,isSigner:!1,isWritable:!0},{pubkey:t.asks,isSigner:!1,isWritable:!0},{pubkey:t.baseVault,isSigner:!1,isWritable:!0},{pubkey:t.quoteVault,isSigner:!1,isWritable:!0},{pubkey:t.baseMint,isSigner:!1,isWritable:!1},{pubkey:t.quoteMint,isSigner:!1,isWritable:!1},{pubkey:t.authority?t.quoteMint:a.SYSVAR_RENT_PUBKEY,isSigner:!1,isWritable:!1}].concat(t.authority?{pubkey:t.authority,isSigner:!1,isWritable:!1}:[]).concat(t.authority&&t.pruneAuthority?{pubkey:t.pruneAuthority,isSigner:!1,isWritable:!1}:[]),s=Buffer.alloc(e.span);return e.encode({version:0,instruction:0,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold},s),new a.TransactionInstruction({keys:o,programId:r,data:s})}async function ee({connection:r,wallet:t,marketInfo:e}){var C,V,_,q,K,U,F,R;let o=new a.Transaction,s=await r.getMinimumBalanceForRentExemption(165);o.add(a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.baseVault.seed,newAccountPubkey:e.baseVault.publicKey,lamports:s,space:165,programId:d.TOKEN_PROGRAM_ID}),a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.quoteVault.seed,newAccountPubkey:e.quoteVault.publicKey,lamports:s,space:165,programId:d.TOKEN_PROGRAM_ID}),(0,d.createInitializeAccountInstruction)(e.baseVault.publicKey,e.baseMint,e.vaultOwner),(0,d.createInitializeAccountInstruction)(e.quoteVault.publicKey,e.quoteMint,e.vaultOwner),a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.id.seed,newAccountPubkey:e.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(A.span),space:A.span,programId:e.programId}));let p=new a.Transaction;return p.add(a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.requestQueue.seed,newAccountPubkey:e.requestQueue.publicKey,lamports:e.lowestFeeMarket?6208320:await r.getMinimumBalanceForRentExemption((C=e.requestQueueSpace)!=null?C:5120+12),space:e.lowestFeeMarket?764:(V=e.requestQueueSpace)!=null?V:5120+12,programId:e.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.eventQueue.seed,newAccountPubkey:e.eventQueue.publicKey,lamports:e.lowestFeeMarket?79594560:await r.getMinimumBalanceForRentExemption((_=e.eventQueueSpace)!=null?_:262144+12),space:e.lowestFeeMarket?11308:(q=e.eventQueueSpace)!=null?q:262144+12,programId:e.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.bids.seed,newAccountPubkey:e.bids.publicKey,lamports:e.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((K=e.orderbookQueueSpace)!=null?K:65536+12),space:e.lowestFeeMarket?14524:(U=e.orderbookQueueSpace)!=null?U:65536+12,programId:e.programId}),a.SystemProgram.createAccountWithSeed({fromPubkey:t,basePubkey:t,seed:e.asks.seed,newAccountPubkey:e.asks.publicKey,lamports:e.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((F=e.orderbookQueueSpace)!=null?F:65536+12),space:e.lowestFeeMarket?14524:(R=e.orderbookQueueSpace)!=null?R:65536+12,programId:e.programId}),z({programId:e.programId,marketInfo:{id:e.id.publicKey,requestQueue:e.requestQueue.publicKey,eventQueue:e.eventQueue.publicKey,bids:e.bids.publicKey,asks:e.asks.publicKey,baseVault:e.baseVault.publicKey,quoteVault:e.quoteVault.publicKey,baseMint:e.baseMint,quoteMint:e.quoteMint,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold}})),[{transaction:o,signer:[],instructionTypes:[i.CreateAccount,i.CreateAccount,i.InitAccount,i.InitAccount]},{transaction:p,signer:[],instructionTypes:[i.CreateAccount,i.CreateAccount,i.CreateAccount,i.CreateAccount,i.CreateAccount,i.InitMarket]}]}0&&(module.exports={initializeMarket,makeCreateMarketInstruction});
//# sourceMappingURL=instrument.js.map