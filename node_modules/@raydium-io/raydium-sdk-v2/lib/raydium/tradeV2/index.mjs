var mr=Object.defineProperty,pr=Object.defineProperties;var dr=Object.getOwnPropertyDescriptors;var ti=Object.getOwnPropertySymbols;var fr=Object.prototype.hasOwnProperty,br=Object.prototype.propertyIsEnumerable;var ni=(i,e,t)=>e in i?mr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Y=(i,e)=>{for(var t in e||(e={}))fr.call(e,t)&&ni(i,t,e[t]);if(ti)for(var t of ti(e))br.call(e,t)&&ni(i,t,e[t]);return i},te=(i,e)=>pr(i,dr(e));import{PublicKey as vP}from"@solana/web3.js";import{createTransferInstruction as WP,TOKEN_PROGRAM_ID as VP,TOKEN_2022_PROGRAM_ID as _P}from"@solana/spl-token";import Ys from"bn.js";var wt=9e15,mt=1e9,dn="0123456789abcdef",Ut="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Xt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",fn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-wt,maxE:wt,crypto:!1},si,$e,G=!0,Qt="[DecimalError] ",lt=Qt+"Invalid argument: ",ai=Qt+"Precision limit exceeded",ui=Qt+"crypto unavailable",ci="[object Decimal]",Ce=Math.floor,Ae=Math.pow,yr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,gr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Pr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,li=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ue=1e7,V=7,kr=9007199254740991,Ar=Ut.length-1,bn=Xt.length-1,w={toStringTag:ci};w.absoluteValue=w.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),W(i)};w.ceil=function(){return W(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(lt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};w.comparedTo=w.cmp=function(i){var e,t,n,r,o=this,a=o.d,s=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!a||!s)return!u||!c?NaN:u!==c?u:a===s?0:!a^u<0?1:-1;if(!a[0]||!s[0])return a[0]?u:s[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=a.length,r=s.length,e=0,t=n<r?n:r;e<t;++e)if(a[e]!==s[e])return a[e]>s[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};w.cosine=w.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+V,n.rounding=1,t=wr(n,bi(n,t)),n.precision=i,n.rounding=e,W($e==2||$e==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};w.cubeRoot=w.cbrt=function(){var i,e,t,n,r,o,a,s,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(G=!1,o=l.s*Ae(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=xe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=Ae(t,1/3),i=Ce((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),a=(i=m.precision)+3;;)if(s=n,u=s.times(s).times(s),c=u.plus(l),n=oe(c.plus(l).times(s),c.plus(u),a+2,1),xe(s.d).slice(0,a)===(t=xe(n.d)).slice(0,a))if(t=t.slice(a-3,a+1),t=="9999"||!r&&t=="4999"){if(!r&&(W(s,i+1,0),s.times(s).times(s).eq(l))){n=s;break}a+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(W(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return G=!0,W(n,i,m.rounding,e)};w.decimalPlaces=w.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ce(this.e/V))*V,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(i){return oe(this,new this.constructor(i))};w.dividedToIntegerBy=w.divToInt=function(i){var e=this,t=e.constructor;return W(oe(e,new t(i),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(i){return this.cmp(i)===0};w.floor=function(){return W(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(i){return this.cmp(i)>0};w.greaterThanOrEqualTo=w.gte=function(i){var e=this.cmp(i);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var i,e,t,n,r,o=this,a=o.constructor,s=new a(1);if(!o.isFinite())return new a(o.s?1/0:NaN);if(o.isZero())return s;t=a.precision,n=a.rounding,a.precision=t+Math.max(o.e,o.sd())+4,a.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Zt(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Tt(a,1,o.times(e),new a(1),!0);for(var u,c=i,l=new a(8);c--;)u=o.times(o),o=s.minus(u.times(l.minus(u.times(l))));return W(o,a.precision=t,a.rounding=n,!0)};w.hyperbolicSine=w.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Tt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Zt(5,i)),r=Tt(o,2,r,r,!0);for(var a,s=new o(5),u=new o(16),c=new o(20);i--;)a=r.times(r),r=r.times(s.plus(a.times(u.times(a).plus(c))))}return o.precision=e,o.rounding=t,W(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,oe(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};w.inverseCosine=w.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ge(t,r,o):new t(0):new t(NaN):e.isZero()?Ge(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Ge(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,G=!1,t=t.times(t).minus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};w.inverseHyperbolicSine=w.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,G=!1,t=t.times(t).plus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?W(new o(r),i,e,!0):(o.precision=t=n-r.e,r=oe(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Ge(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};w.inverseTangent=w.atan=function(){var i,e,t,n,r,o,a,s,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=bn)return a=Ge(l,m+4,d).times(.25),a.s=c.s,a}else{if(!c.s)return new l(NaN);if(m+4<=bn)return a=Ge(l,m+4,d).times(.5),a.s=c.s,a}for(l.precision=s=m+10,l.rounding=1,t=Math.min(28,s/V+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(G=!1,e=Math.ceil(s/V),n=1,u=c.times(c),a=new l(c),r=c;i!==-1;)if(r=r.times(u),o=a.minus(r.div(n+=2)),r=r.times(u),a=o.plus(r.div(n+=2)),a.d[e]!==void 0)for(i=e;a.d[i]===o.d[i]&&i--;);return t&&(a=a.times(2<<t-1)),G=!0,W(a,l.precision=m,l.rounding=d,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&Ce(this.e/V)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(i){return this.cmp(i)<0};w.lessThanOrEqualTo=w.lte=function(i){return this.cmp(i)<1};w.logarithm=w.log=function(i){var e,t,n,r,o,a,s,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(G=!1,s=m+p,a=ct(c,s),n=e?zt(l,s+10):ct(i,s),u=oe(a,n,s,1),xt(u.d,r=m,d))do if(s+=10,a=ct(c,s),n=e?zt(l,s+10):ct(i,s),u=oe(a,n,s,1),!o){+xe(u.d).slice(r+1,r+15)+1==1e14&&(u=W(u,m+1,0));break}while(xt(u.d,r+=10,d));return G=!0,W(u,m,d)};w.minus=w.sub=function(i){var e,t,n,r,o,a,s,u,c,l,m,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,s=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(p);else return new g(u===3?-0:0);return G?W(i,s,u):i}if(t=Ce(i.e/V),l=Ce(p.e/V),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,a=d.length):(e=d,t=l,a=c.length),n=Math.max(Math.ceil(s/V),a)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,a=d.length,m=n<a,m&&(a=n),n=0;n<a;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),a=c.length,n=d.length-a;n>0;--n)c[a++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Ue-1;--c[r],c[n]+=Ue}c[n]-=d[n]}for(;c[--a]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Ht(c,t),G?W(i,s,u):i):new g(u===3?-0:0)};w.modulo=w.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?W(new n(t),n.precision,n.rounding):(G=!1,n.modulo==9?(e=oe(t,i.abs(),0,3,1),e.s*=i.s):e=oe(t,i,0,n.modulo,1),e=e.times(i),G=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return yn(this)};w.naturalLogarithm=w.ln=function(){return ct(this)};w.negated=w.neg=function(){var i=new this.constructor(this);return i.s=-i.s,W(i)};w.plus=w.add=function(i){var e,t,n,r,o,a,s,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,s=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),G?W(i,s,u):i;if(o=Ce(m.e/V),n=Ce(i.e/V),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,a=l.length):(t=l,n=o,a=c.length),o=Math.ceil(s/V),a=o>a?o+1:a+1,r>a&&(r=a,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(a=c.length,r=l.length,a-r<0&&(r=a,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ue|0,c[r]%=Ue;for(e&&(c.unshift(e),++n),a=c.length;c[--a]==0;)c.pop();return i.d=c,i.e=Ht(c,n),G?W(i,s,u):i};w.precision=w.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(lt+i);return t.d?(e=mi(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var i=this,e=i.constructor;return W(new e(i),i.e+1,e.rounding)};w.sine=w.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+V,n.rounding=1,t=hr(n,bi(n,t)),n.precision=i,n.rounding=e,W($e>2?t.neg():t,i,e,!0)):new n(NaN)};w.squareRoot=w.sqrt=function(){var i,e,t,n,r,o,a=this,s=a.d,u=a.e,c=a.s,l=a.constructor;if(c!==1||!s||!s[0])return new l(!c||c<0&&(!s||s[0])?NaN:s?a:1/0);for(G=!1,c=Math.sqrt(+a),c==0||c==1/0?(e=xe(s),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ce((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(oe(a,o,t+2,1)).times(.5),xe(o.d).slice(0,t)===(e=xe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(W(o,u+1,0),o.times(o).eq(a))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(W(n,u+1,1),i=!n.times(n).eq(a));break}return G=!0,W(n,u,l.rounding,i)};w.tangent=w.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=oe(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,W($e==2||$e==4?t.neg():t,i,e,!0)):new n(NaN)};w.times=w.mul=function(i){var e,t,n,r,o,a,s,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Ce(l.e/V)+Ce(i.e/V),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,a=u,u=c,c=a),o=[],a=u+c,n=a;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)s=o[r]+p[n]*d[r-n-1]+e,o[r--]=s%Ue|0,e=s/Ue|0;o[r]=(o[r]+e)%Ue|0}for(;!o[--a];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Ht(o,t),G?W(i,m.precision,m.rounding):i};w.toBinary=function(i,e){return Pn(this,2,i,e)};w.toDecimalPlaces=w.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Me(i,0,mt),e===void 0?e=n.rounding:Me(e,0,8),W(t,i+t.e+1,e))};w.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,!0):(Me(i,0,mt),e===void 0?e=r.rounding:Me(e,0,8),n=W(new r(n),i+1,e),t=Qe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Qe(r):(Me(i,0,mt),e===void 0?e=o.rounding:Me(e,0,8),n=W(new o(r),i+r.e+1,e),t=Qe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(i){var e,t,n,r,o,a,s,u,c,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=mi(g)-p.e-1,a=o%V,e.d[0]=Ae(10,a<0?V+a:a),i==null)i=o>0?e:c;else{if(s=new f(i),!s.isInt()||s.lt(c))throw Error(lt+s);i=s.gt(e)?o>0?e:c:s}for(G=!1,s=new f(xe(g)),l=f.precision,f.precision=o=g.length*V*2;m=oe(s,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=s.minus(m.times(r)),s=r;return r=oe(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=oe(c,n,o,1).minus(p).abs().cmp(oe(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,G=!0,d};w.toHexadecimal=w.toHex=function(i,e){return Pn(this,16,i,e)};w.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Me(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(G=!1,t=oe(t,i,0,e,1).times(i),G=!0,W(t)):(i.s=t.s,t=i),t};w.toNumber=function(){return+this};w.toOctal=function(i,e){return Pn(this,8,i,e)};w.toPower=w.pow=function(i){var e,t,n,r,o,a,s=this,u=s.constructor,c=+(i=new u(i));if(!s.d||!i.d||!s.d[0]||!i.d[0])return new u(Ae(+s,c));if(s=new u(s),s.eq(1))return s;if(n=u.precision,o=u.rounding,i.eq(1))return W(s,n,o);if(e=Ce(i.e/V),e>=i.d.length-1&&(t=c<0?-c:c)<=kr)return r=pi(u,s,t,n),i.s<0?new u(1).div(r):W(r,n,o);if(a=s.s,a<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(a=1),s.e==0&&s.d[0]==1&&s.d.length==1)return s.s=a,s}return t=Ae(+s,c),e=t==0||!isFinite(t)?Ce(c*(Math.log("0."+xe(s.d))/Math.LN10+s.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?a/0:0):(G=!1,u.rounding=s.s=1,t=Math.min(12,(e+"").length),r=yn(i.times(ct(s,n+t)),n),r.d&&(r=W(r,n+5,1),xt(r.d,n,o)&&(e=n+10,r=W(yn(i.times(ct(s,e+t)),e),e+5,1),+xe(r.d).slice(n+1,n+15)+1==1e14&&(r=W(r,n+1,0)))),r.s=a,G=!0,u.rounding=o,W(r,n,o))};w.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Me(i,1,mt),e===void 0?e=r.rounding:Me(e,0,8),n=W(new r(n),i,e),t=Qe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Me(i,1,mt),e===void 0?e=n.rounding:Me(e,0,8)),W(new n(t),i,e)};w.toString=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return W(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function xe(i){var e,t,n,r=i.length-1,o="",a=i[0];if(r>0){for(o+=a,e=1;e<r;e++)n=i[e]+"",t=V-n.length,t&&(o+=ut(t)),o+=n;a=i[e],n=a+"",t=V-n.length,t&&(o+=ut(t))}else if(a===0)return"0";for(;a%10===0;)a/=10;return o+a}function Me(i,e,t){if(i!==~~i||i<e||i>t)throw Error(lt+i)}function xt(i,e,t,n){var r,o,a,s;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=V,r=0):(r=Math.ceil((e+1)/V),e%=V),o=Ae(10,V-e),s=i[r]%o|0,n==null?e<3?(e==0?s=s/100|0:e==1&&(s=s/10|0),a=t<4&&s==99999||t>3&&s==49999||s==5e4||s==0):a=(t<4&&s+1==o||t>3&&s+1==o/2)&&(i[r+1]/o/100|0)==Ae(10,e-2)-1||(s==o/2||s==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?s=s/1e3|0:e==1?s=s/100|0:e==2&&(s=s/10|0),a=(n||t<4)&&s==9999||!n&&t>3&&s==4999):a=((n||t<4)&&s+1==o||!n&&t>3&&s+1==o/2)&&(i[r+1]/o/1e3|0)==Ae(10,e-3)-1,a}function Gt(i,e,t){for(var n,r=[0],o,a=0,s=i.length;a<s;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=dn.indexOf(i.charAt(a++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function wr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Zt(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Tt(i,1,e.times(r),new i(1));for(var o=t;o--;){var a=e.times(e);e=a.times(a).minus(a).times(8).plus(1)}return i.precision-=t,e}var oe=function(){function i(n,r,o){var a,s=0,u=n.length;for(n=n.slice();u--;)a=n[u]*r+s,n[u]=a%o|0,s=a/o|0;return s&&n.unshift(s),n}function e(n,r,o,a){var s,u;if(o!=a)u=o>a?1:-1;else for(s=u=0;s<o;s++)if(n[s]!=r[s]){u=n[s]>r[s]?1:-1;break}return u}function t(n,r,o,a){for(var s=0;o--;)n[o]-=s,s=n[o]<r[o]?1:0,n[o]=s*a+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,a,s,u){var c,l,m,d,p,g,f,b,y,h,T,N,v,I,L,R,D,x,F,ye,se=n.constructor,he=n.s==r.s?1:-1,de=n.d,ee=r.d;if(!de||!de[0]||!ee||!ee[0])return new se(!n.s||!r.s||(de?ee&&de[0]==ee[0]:!ee)?NaN:de&&de[0]==0||!ee?he*0:he/0);for(u?(p=1,l=n.e-r.e):(u=Ue,p=V,l=Ce(n.e/p)-Ce(r.e/p)),F=ee.length,D=de.length,y=new se(he),h=y.d=[],m=0;ee[m]==(de[m]||0);m++);if(ee[m]>(de[m]||0)&&l--,o==null?(I=o=se.precision,a=se.rounding):s?I=o+(n.e-r.e)+1:I=o,I<0)h.push(1),g=!0;else{if(I=I/p+2|0,m=0,F==1){for(d=0,ee=ee[0],I++;(m<D||d)&&I--;m++)L=d*u+(de[m]||0),h[m]=L/ee|0,d=L%ee|0;g=d||m<D}else{for(d=u/(ee[0]+1)|0,d>1&&(ee=i(ee,d,u),de=i(de,d,u),F=ee.length,D=de.length),R=F,T=de.slice(0,F),N=T.length;N<F;)T[N++]=0;ye=ee.slice(),ye.unshift(0),x=ee[0],ee[1]>=u/2&&++x;do d=0,c=e(ee,T,F,N),c<0?(v=T[0],F!=N&&(v=v*u+(T[1]||0)),d=v/x|0,d>1?(d>=u&&(d=u-1),f=i(ee,d,u),b=f.length,N=T.length,c=e(f,T,b,N),c==1&&(d--,t(f,F<b?ye:ee,b,u))):(d==0&&(c=d=1),f=ee.slice()),b=f.length,b<N&&f.unshift(0),t(T,f,N,u),c==-1&&(N=T.length,c=e(ee,T,F,N),c<1&&(d++,t(T,F<N?ye:ee,N,u))),N=T.length):c===0&&(d++,T=[0]),h[m++]=d,c&&T[0]?T[N++]=de[R]||0:(T=[de[R]],N=1);while((R++<D||T[0]!==void 0)&&I--);g=T[0]!==void 0}h[0]||h.shift()}if(p==1)y.e=l,si=g;else{for(m=1,d=h[0];d>=10;d/=10)m++;y.e=m+l*p-1,W(y,s?o+y.e+1:o,a,g)}return y}}();function W(i,e,t,n){var r,o,a,s,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,s=m[0];s>=10;s/=10)r++;if(o=e-r,o<0)o+=V,a=e,l=m[d=0],u=l/Ae(10,r-a-1)%10|0;else if(d=Math.ceil((o+1)/V),s=m.length,d>=s)if(n){for(;s++<=d;)m.push(0);l=u=0,r=1,o%=V,a=o-V+1}else break e;else{for(l=s=m[d],r=1;s>=10;s/=10)r++;o%=V,a=o-V+r,u=a<0?0:l/Ae(10,r-a-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(a<0?l:l%Ae(10,r-a-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?a>0?l/Ae(10,r-a):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=Ae(10,(V-e%V)%V),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,s=1,d--):(m.length=d+1,s=Ae(10,V-o),m[d]=a>0?(l/Ae(10,r-a)%Ae(10,a)|0)*s:0),c)for(;;)if(d==0){for(o=1,a=m[0];a>=10;a/=10)o++;for(a=m[0]+=s,s=1;a>=10;a/=10)s++;o!=s&&(i.e++,m[0]==Ue&&(m[0]=1));break}else{if(m[d]+=s,m[d]!=Ue)break;m[d--]=0,s=1}for(o=m.length;m[--o]===0;)m.pop()}return G&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Qe(i,e,t){if(!i.isFinite())return fi(i);var n,r=i.e,o=xe(i.d),a=o.length;return e?(t&&(n=t-a)>0?o=o.charAt(0)+"."+o.slice(1)+ut(n):a>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+ut(-r-1)+o,t&&(n=t-a)>0&&(o+=ut(n))):r>=a?(o+=ut(r+1-a),t&&(n=t-r-1)>0&&(o=o+"."+ut(n))):((n=r+1)<a&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-a)>0&&(r+1===a&&(o+="."),o+=ut(n))),o}function Ht(i,e){var t=i[0];for(e*=V;t>=10;t/=10)e++;return e}function zt(i,e,t){if(e>Ar)throw G=!0,t&&(i.precision=t),Error(ai);return W(new i(Ut),e,1,!0)}function Ge(i,e,t){if(e>bn)throw Error(ai);return W(new i(Xt),e,t,!0)}function mi(i){var e=i.length-1,t=e*V+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function ut(i){for(var e="";i--;)e+="0";return e}function pi(i,e,t,n){var r,o=new i(1),a=Math.ceil(n/V+4);for(G=!1;;){if(t%2&&(o=o.times(e),ri(o.d,a)&&(r=!0)),t=Ce(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),ri(e.d,a)}return G=!0,o}function ii(i){return i.d[i.d.length-1]&1}function di(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function yn(i,e){var t,n,r,o,a,s,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(G=!1,u=g):u=e,s=new d(.03125);i.e>-2;)i=i.times(s),m+=5;for(n=Math.log(Ae(2,m))/Math.LN10*2+5|0,u+=n,t=o=a=new d(1),d.precision=u;;){if(o=W(o.times(i),u,1),t=t.times(++l),s=a.plus(oe(o,t,u,1)),xe(s.d).slice(0,u)===xe(a.d).slice(0,u)){for(r=m;r--;)a=W(a.times(a),u,1);if(e==null)if(c<3&&xt(a.d,u-n,p,c))d.precision=u+=10,t=o=s=new d(1),l=0,c++;else return W(a,d.precision=g,p,G=!0);else return d.precision=g,a}a=s}}function ct(i,e){var t,n,r,o,a,s,u,c,l,m,d,p=1,g=10,f=i,b=f.d,y=f.constructor,h=y.rounding,T=y.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new y(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(G=!1,l=T):l=e,y.precision=l+=g,t=xe(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=xe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new y("0."+t),o++):f=new y(n+"."+t.slice(1))}else return c=zt(y,l+2,T).times(o+""),f=ct(new y(n+"."+t.slice(1)),l-g).plus(c),y.precision=T,e==null?W(f,T,h,G=!0):f;for(m=f,u=a=f=oe(f.minus(1),f.plus(1),l,1),d=W(f.times(f),l,1),r=3;;){if(a=W(a.times(d),l,1),c=u.plus(oe(a,new y(r),l,1)),xe(c.d).slice(0,l)===xe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(zt(y,l+2,T).times(o+""))),u=oe(u,new y(p),l,1),e==null)if(xt(u.d,l-g,h,s))y.precision=l+=g,c=a=f=oe(m.minus(1),m.plus(1),l,1),d=W(f.times(f),l,1),r=s=1;else return W(u,y.precision=T,h,G=!0);else return y.precision=T,u;u=c,r+=2}}function fi(i){return String(i.s*i.s/0)}function gn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%V,t<0&&(n+=V),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=V;n<r;)i.d.push(+e.slice(n,n+=V));e=e.slice(n),n=V-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),G&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Tr(i,e){var t,n,r,o,a,s,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),li.test(e))return gn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(gr.test(e))t=16,e=e.toLowerCase();else if(yr.test(e))t=2;else if(Pr.test(e))t=8;else throw Error(lt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),a=o>=0,n=i.constructor,a&&(e=e.replace(".",""),s=e.length,o=s-o,r=pi(n,new n(t),o,o*2)),c=Gt(e,t,Ue),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Ht(c,l),i.d=c,G=!1,a&&(i=oe(i,r,s*4)),u&&(i=i.times(Math.abs(u)<54?Ae(2,u):St.pow(2,u))),G=!0,i)}function hr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Tt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Zt(5,t)),e=Tt(i,2,e,e);for(var r,o=new i(5),a=new i(16),s=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(a.times(r).minus(s))));return e}function Tt(i,e,t,n,r){var o,a,s,u,c=1,l=i.precision,m=Math.ceil(l/V);for(G=!1,u=t.times(t),s=new i(n);;){if(a=oe(s.times(u),new i(e++*e++),l,1),s=r?n.plus(a):n.minus(a),n=oe(a.times(u),new i(e++*e++),l,1),a=s.plus(n),a.d[m]!==void 0){for(o=m;a.d[o]===s.d[o]&&o--;);if(o==-1)break}o=s,s=n,n=a,a=o,c++}return G=!0,a.d.length=m+1,a}function Zt(i,e){for(var t=i;--e;)t*=i;return t}function bi(i,e){var t,n=e.s<0,r=Ge(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return $e=n?4:1,e;if(t=e.divToInt(r),t.isZero())$e=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return $e=ii(t)?n?2:3:n?4:1,e;$e=ii(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Pn(i,e,t,n){var r,o,a,s,u,c,l,m,d,p=i.constructor,g=t!==void 0;if(g?(Me(t,1,mt),n===void 0?n=p.rounding:Me(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=fi(i);else{for(l=Qe(i),a=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,a>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-a,d.d=Gt(Qe(d),10,r),d.e=d.d.length),m=Gt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(a<0?o--:(i=new p(i),i.d=m,i.e=o,i=oe(i,d,t,n,0,r),m=i.d,o=i.e,c=si),a=m[t],s=r/2,c=c||m[t+1]!==void 0,c=n<4?(a!==void 0||c)&&(n===0||n===(i.s<0?3:2)):a>s||a===s&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(a=0,l="";a<u;a++)l+=dn.charAt(m[a]);if(g){if(u>1)if(e==16||e==8){for(a=e==16?4:3,--u;u%a;u++)l+="0";for(m=Gt(l,r,e),u=m.length;!m[u-1];--u);for(a=1,l="1.";a<u;a++)l+=dn.charAt(m[a])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function ri(i,e){if(i.length>e)return i.length=e,!0}function Ir(i){return new this(i).abs()}function Br(i){return new this(i).acos()}function xr(i){return new this(i).acosh()}function Sr(i,e){return new this(i).plus(e)}function Kr(i){return new this(i).asin()}function Cr(i){return new this(i).asinh()}function Nr(i){return new this(i).atan()}function Lr(i){return new this(i).atanh()}function Rr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Ge(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Ge(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Ge(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(oe(i,e,o,1)),e=Ge(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(oe(i,e,o,1)),t}function Mr(i){return new this(i).cbrt()}function Or(i){return W(i=new this(i),i.e+1,2)}function Er(i,e,t){return new this(i).clamp(e,t)}function vr(i){if(!i||typeof i!="object")throw Error(Qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,mt,"rounding",0,8,"toExpNeg",-wt,0,"toExpPos",0,wt,"maxE",0,wt,"minE",-wt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=fn[t]),(n=i[t])!==void 0)if(Ce(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(lt+t+": "+n);if(t="crypto",r&&(this[t]=fn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ui);else this[t]=!1;else throw Error(lt+t+": "+n);return this}function Fr(i){return new this(i).cos()}function Wr(i){return new this(i).cosh()}function yi(i){var e,t,n;function r(o){var a,s,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,oi(o)){c.s=o.s,G?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(a=0,s=o;s>=10;s/=10)a++;G?a>r.maxE?(c.e=NaN,c.d=null):a<r.minE?(c.e=0,c.d=[0]):(c.e=a,c.d=[o]):(c.e=a,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return gn(c,o.toString())}else if(u!=="string")throw Error(lt+o);return(s=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(s===43&&(o=o.slice(1)),c.s=1),li.test(o)?gn(c,o):Tr(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=vr,r.clone=yi,r.isDecimal=oi,r.abs=Ir,r.acos=Br,r.acosh=xr,r.add=Sr,r.asin=Kr,r.asinh=Cr,r.atan=Nr,r.atanh=Lr,r.atan2=Rr,r.cbrt=Mr,r.ceil=Or,r.clamp=Er,r.cos=Fr,r.cosh=Wr,r.div=Vr,r.exp=_r,r.floor=Dr,r.hypot=qr,r.ln=Gr,r.log=Ur,r.log10=zr,r.log2=Xr,r.max=Qr,r.min=Hr,r.mod=Zr,r.mul=jr,r.pow=Yr,r.random=Jr,r.round=$r,r.sign=eo,r.sin=to,r.sinh=no,r.sqrt=io,r.sub=ro,r.sum=oo,r.tan=so,r.tanh=ao,r.trunc=uo,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Vr(i,e){return new this(i).div(e)}function _r(i){return new this(i).exp()}function Dr(i){return W(i=new this(i),i.e+1,3)}function qr(){var i,e,t=new this(0);for(G=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return G=!0,new this(1/0);t=e}return G=!0,t.sqrt()}function oi(i){return i instanceof St||i&&i.toStringTag===ci||!1}function Gr(i){return new this(i).ln()}function Ur(i,e){return new this(i).log(e)}function Xr(i){return new this(i).log(2)}function zr(i){return new this(i).log(10)}function Qr(){return di(this,arguments,"lt")}function Hr(){return di(this,arguments,"gt")}function Zr(i,e){return new this(i).mod(e)}function jr(i,e){return new this(i).mul(e)}function Yr(i,e){return new this(i).pow(e)}function Jr(i){var e,t,n,r,o=0,a=new this(1),s=[];if(i===void 0?i=this.precision:Me(i,1,mt),n=Math.ceil(i/V),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:s[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(s.push(r%1e7),o+=4);o=n/4}else throw Error(ui);else for(;o<n;)s[o++]=Math.random()*1e7|0;for(n=s[--o],i%=V,n&&i&&(r=Ae(10,V-i),s[o]=(n/r|0)*r);s[o]===0;o--)s.pop();if(o<0)t=0,s=[0];else{for(t=-1;s[0]===0;t-=V)s.shift();for(n=1,r=s[0];r>=10;r/=10)n++;n<V&&(t-=V-n)}return a.e=t,a.d=s,a}function $r(i){return W(i=new this(i),i.e+1,this.rounding)}function eo(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function to(i){return new this(i).sin()}function no(i){return new this(i).sinh()}function io(i){return new this(i).sqrt()}function ro(i,e){return new this(i).sub(e)}function oo(){var i=0,e=arguments,t=new this(e[i]);for(G=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return G=!0,W(t,this.precision,this.rounding)}function so(i){return new this(i).tan()}function ao(i){return new this(i).tanh()}function uo(i){return W(i=new this(i),i.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var St=w.constructor=yi(fn);Ut=new St(Ut);Xt=new St(Xt);var O=St;import{PublicKey as mo}from"@solana/web3.js";import{get as gi,set as co}from"lodash";var kn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Pi={},lo={};function ae(i){let e=gi(Pi,i);if(!e){let t=gi(lo,i);e=new kn({name:i,logLevel:t}),co(Pi,i,e)}return e}import{MINT_SIZE as ca,TOKEN_PROGRAM_ID as la,getTransferFeeConfig as ma,unpackMint as pa}from"@solana/spl-token";var An=ae("Raydium_accountInfo_util");async function pt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=Y({batchRequest:!1},t),a=wn(e,o),s=new Array(a.length).fill([]);if(n){let u=a.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=wn(u,10);s=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:b,rentEpoch:y}=d;return p.length!==2&&p[1]!=="base64"&&An.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new mo(b),rentEpoch:y}}return null})))}else try{s=await Promise.all(a.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&An.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return s.flat()}async function Kt(i,e,t){let n=await pt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>te(Y({},r),{accountInfo:n[o]}))}import nt from"bn.js";import Ao from"big.js";import Jt from"bn.js";import po from"toformat";var fo=po,Nt=fo;import Yt from"big.js";import yo from"bn.js";import go from"decimal.js-light";import Lt from"bn.js";var ki=9007199254740991;function ue(i){let e=ae("Raydium_parseBigNumberish");if(i instanceof Lt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Lt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ki||i<=-ki)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Lt(String(i))):typeof i=="bigint"?new Lt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Lt(0))}var jt=ae("module/fraction"),Tn=Nt(Yt),Rt=Nt(go),Po={[0]:Rt.ROUND_DOWN,[1]:Rt.ROUND_HALF_UP,[2]:Rt.ROUND_UP},ko={[0]:Yt.roundDown,[1]:Yt.roundHalfUp,[2]:Yt.roundUp},J=class{constructor(e,t=new yo(1)){this.numerator=ue(e),this.denominator=ue(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(ue(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(ue(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(ue(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(ue(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||jt.logWithError(`${e} is not an integer.`),e<=0&&jt.logWithError(`${e} is not positive.`),Rt.set({precision:e+1,rounding:Po[n]});let r=new Rt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||jt.logWithError(`${e} is not an integer.`),e<0&&jt.logWithError(`${e} is negative.`),Tn.DP=e,Tn.RM=ko[n]||1,new Tn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var wo=ae("Raydium_amount"),Ai=Nt(Ao);function To(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):wo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var we=class extends J{constructor(t,n,r=!0,o){let a=new Jt(0),s=hn.pow(new Jt(t.decimals));if(r)a=ue(n);else{let u=new Jt(0),c=new Jt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=To(n.toString(),t.decimals);u=ue(l),c=ue(m)}u=u.mul(s),a=u.add(c)}super(a,s);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new we(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new we(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Ai.DP=this.token.decimals,new Ai(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as ho}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as wi}from"@solana/spl-token";var In={chainId:101,address:ho.default.toBase58(),programId:wi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},et={chainId:101,address:"So11111111111111111111111111111111111111112",programId:wi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Sn}from"@solana/web3.js";import{PublicKey as me,SystemProgram as Ti,SYSVAR_RENT_PUBKEY as Io}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Bo}from"@solana/spl-token";function P({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ua=[P({pubkey:Bo,isWritable:!1}),P({pubkey:Ti.programId,isWritable:!1}),P({pubkey:Io,isWritable:!1})];function Bn({publicKey:i,transformSol:e}){let t=xn(i.toString());if(t instanceof me)return e&&t.equals(Mt)?Ct:t;if(e&&t.toString()===Mt.toBase58())return Ct;if(typeof t=="string"){if(t===me.default.toBase58())return me.default;try{return new me(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function xn(i){try{return new me(i)}catch{return i}}var $t=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),dt=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),He=new me("SysvarRent111111111111111111111111111111111"),Xa=new me("SysvarC1ock11111111111111111111111111111111"),ft=new me("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),za=new me("Sysvar1nstructions1111111111111111111111111"),xo=Ti.programId,Qa=new me("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ha=new me("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Za=new me("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ja=new me("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ya=new me("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ja=new me("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),$a=new me("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),eu=new me("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),tu=new me("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),nu=new me("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),iu=new me("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Ct=new me("So11111111111111111111111111111111111111112"),Mt=me.default;function ht(i){return Bn({publicKey:i,transformSol:!0})}var Kn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:a=!1}){if(e===Mt.toBase58()||e instanceof Sn&&Mt.equals(e)){this.decimals=et.decimals,this.symbol=et.symbol,this.name=et.name,this.mint=new Sn(et.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Sn.default:Bn({publicKey:e}),this.isToken2022=a}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Xe=Kn;Xe.WSOL=new Kn(te(Y({},et),{mint:et.address}));var Cn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},en=Cn;en.SOL=new Cn(In);import So from"bn.js";var hi=new J(new So(100)),tt=class extends J{toSignificant(e=5,t,n){return this.mul(hi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(hi).toFixed(e,t,n)}};var Ko=ae("Raydium_price"),Ee=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:a}=t;super(o,a);this.baseToken=n,this.quoteToken=r,this.scalar=new J(Nn(n.decimals),Nn(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ko.logWithError("mul token not equals");let n=super.mul(t);return new Ee({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as Co}from"@solana/web3.js";import No from"bn.js";function Bi(i){return typeof i=="object"&&i!==null&&![Xe,we,Co,J,No,Ee,tt].some(e=>typeof e=="object"&&i instanceof e)}function ve(i){return typeof i=="string"?xn(i):Array.isArray(i)?i.map(e=>ve(e)):Bi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,ve(t)])):i}var Ii=new nt(0),Lo=new nt(1),Ju=new nt(2),$u=new nt(3),ec=new nt(5),hn=new nt(10),tc=new nt(100),nc=new nt(1e3),ic=new nt(1e4);function Nn(i){return hn.pow(ue(i))}function wn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Mo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Oo}from"@solana/spl-token";import{ComputeBudgetProgram as mc,Keypair as fc,PublicKey as Ro,Transaction as yc,TransactionMessage as Pc,VersionedTransaction as kc}from"@solana/web3.js";var ne={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee",TransferTip:"TransferTip"};import{TOKEN_PROGRAM_ID as hc}from"@solana/spl-token";var Ic=ae("Raydium_txUtil");function Se(i,e){let[t,n]=Ro.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function re(i,e,t){return Se([i.toBuffer(),(t!=null?t:Oo).toBuffer(),e.toBuffer()],new Mo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as U}from"@solana/web3.js";var Eo=new U("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Lc=new U("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),vo=new U("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Fo=new U("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Wo=new U("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Vo=new U("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Ln=new U("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),xi=new U("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),_o=new U("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),tn=new U("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Rn=new U("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Si=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ki=new U("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Do=new U("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Rc=new U("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Mc=new U("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Oc=new U("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ec=new U("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),vc=new U("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Mn=new U("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Ci=new U("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),qo=new U("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Go=new U("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Uo=new U("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Xo=new U("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),zo=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Qo=new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Ho=new U("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Zo=new U("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),jo=new U("LanMV9sAd7wArD4vJFi2qDdfnVhFxYSUg6eADduJ3uj"),Yo=new U("WLHv2UAZm6z4KyaaELi5pjdbJh6RESMva1Rnn8pJVVh"),Jo=new U("7soRSLviCKHCKzCbRuVpZDif76NWLVqFtbjt8LpyxWSq"),$o=new U("DG6kZFFCqxdtWXw53Zc28hLs3MTr28Efkm2FrsNERNSQ");var Le={AMM_V4:xi,AMM_STABLE:_o,CLMM_PROGRAM_ID:Rn,CLMM_LOCK_PROGRAM_ID:Si,CLMM_LOCK_AUTH_ID:Ki,FARM_PROGRAM_ID_V3:Eo,FARM_PROGRAM_ID_V5:vo,FARM_PROGRAM_ID_V6:Fo,OPEN_BOOK_PROGRAM:Vo,SERUM_PROGRAM_ID_V3:Ln,UTIL1216:Wo,Router:Do,CREATE_CPMM_POOL_PROGRAM:Mn,CREATE_CPMM_POOL_AUTH:Ci,CREATE_CPMM_POOL_FEE_ACC:qo,LOCK_CPMM_PROGRAM:zo,LOCK_CPMM_AUTH:Ho,LAUNCHPAD_PROGRAM:jo,LAUNCHPAD_AUTH:Yo},Fc={SERUM_MARKET:U.default,OPENBOOK_MARKET:new U("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:U.default,FarmV3:new U("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new U("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new U("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new U("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new U("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new U("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new U("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new U("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Go,CREATE_CPMM_POOL_AUTH:Uo,CREATE_CPMM_POOL_FEE_ACC:Xo,FEE_DESTINATION_ID:new U("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Qo,LCOK_CPMM_AUTH:Zo,LAUNCHPAD_PROGRAM:Jo,LAUNCHPAD_AUTH:$o};import ze from"bn.js";var Ot=1e4;function ge(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=te(Y({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,a=new ze(o.maximumFee.toString()),s=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ot){let u=new ze(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:s}}else{let u=nn(i.mul(new ze(Ot)),new ze(Ot-o.transferFeeBasisPoints)),c=new ze(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=nn(l.mul(new ze(o.transferFeeBasisPoints)),new ze(Ot)),d=m.gt(a)?a:m;return{amount:l,fee:d,expirationTime:s}}else{let u=nn(i.mul(new ze(o.transferFeeBasisPoints)),new ze(Ot)),c=u.gt(a)?a:u;return{amount:i,fee:c,expirationTime:s}}}function it(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function nn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new ze(0))?t.add(new ze(1)):t}import{PublicKey as es,AddressLookupTableAccount as Ni}from"@solana/web3.js";var ts={AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU:new Ni({key:new es("AcL1Vo8oy1ULiavEcjSUcwfBSForXMudcZvDZy5nzJkU"),state:Ni.deserialize(Buffer.from("AQAAAP//////////I1rcEwAAAAAvAQYwun9CU6c5Ikm2pAj+D9IEnCOR45nK+SFTGSdpd6J6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbd9uHXZaGT2cvhRs7reawctIXtX1s3kTqM9YV+/wCpBt324e51j94YQl285GzN2rYa/E2DuQ0n/r35KNihi/wFSlNQ+F3IgtYUpVZyeIopbd8eq6vQpgZ4iEky9O72oAVKU1qZKSEGTSTocWDaOHx8NbXdvJK7geQfqEBBBUSNBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvBkX2T9y7AHdNGviJAqQNtlDUDCnauQRWybsLji6nPM8Qkw5asQRvCdB3MbX6IEBwytOrpM32l4jQygKG9TKgR0vZScQ2AsM/IHeQ7RajUkyhuZdc8SGiqQz/7H34torNR/Wir3sl0ruUrVxJWEZfUg+QLNAxxODdBi53/OP7Ioil1cqeBM9dtZC3FLov4yyxWRM/wcGStyJX/QfTnLBAHqkqWotPKVlShCVQqpP9W5W1rOao65IMk5QuQ2kMIOxzDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu/YsA/yfEEFGcr8Z57VKDw8uQzpiru7g4lvjnfapW62W030syevD8k07SGoxUHiuT/ai7gAHWWhDsVmg/C63ajgpkH7Sn3GdutArDTfyqOkdqv4/IPC/EFFy7mGkfDd2C57N5a/4jC+BbmJy7wQaSEZr0CQU88lPtUxIVvzGjC95b8Ooss2TqmkrayGKofkPMGQn7Ux+9lfwBSNfxwH8NgbpqC/7LNlV4I7nCvsXf3p+ohQk9NrAJb2KAFpUqEIJ9ZBV7BYDzHF/ORKYlgtvPnXjudZQ6CEo5OzUDaNIomTCCsvhD16TxJjsbgne1kGnQPCFSoaxUbq2V1bPMFQ3VYP6wDZ9bKStCFKx9A3tNbwZFC5ZGAN83MFK7XoTy+OmmcFEr6rLOjfSuTfPvHJkSVxW6Qllwkl67XcBi5v00u2gQsbu+38sp+rd5pA/LvyWj4P94ZGZwc1tE2P88xekCLcAwZGb+UhFzL/7K26csOb57yM5bvF9xJrLEObOkAAAAAn+HWRkdcPKyFFMnVwEoD7vnD0jCKFIU1sImubYCxNTSVzsKpaQX+fzNxrLAI3L14JQnJx/D6Uk2LADIHGqnGELzjEbkBDAlaM77NkXMPfqXNLSveCkWI7UEgNs31WEWB6XHSYI/v5DklHOb4QTtDOR804PVbi3fjloZeLR2F8d4FuZmMMO7ck3Fnkn2zEMG5gOmqsygb6PjTitArVl52NhcSznTxVnguaIJxiZkAnurDmn3MWR0PC2GLghp2KJqHCc6QQ85odeIjFHKOlRlJyeSXVJmL8vb1UgOzsbJPVP8p6zM4M3C1Sd7uWIHP33G42AP2Zg8ucn/n6meQjjD266JgCWdxZD6PXs9CsnIeL7SSG0/6lGb9xfP0ZcWkCXB/3hjxHYVXjra/GPOeXGk0fLLKjCbk+mgs2w6d2oCwimBipTzuoZ30GiI8ij8VRzD5CzMWtu2m21eDBIfjGAEo4pQeNNonKcqzV/cleX8ySZLOHsz8PtBCrLqF+VkLm9hOzIT+6i/nIf6keR4GWKMOD4AvqfpjHoD4DuhBpz8P28+DxkGrDXXr/nr20x291VPvcTU/b+b+o2kC9G0kcXeTlLjU6a2TQXWlZ4gBUdBl1jgT7mObSTpLblNiXZsLkbmVXZwvFKXua5cUKlWed/w30skmEUraTuQqtqr5fHZPW9n57EmeTif6LjHL2YJFZkQU+TrJmFzqzmF4/b8OwrPQAprl8mX3q4LUIdAS/a+11B6DWD1Xk2++Sn94dLC4xjkO4Wtlw8c4XuzciVbepHOmnoWzVu/0y3KCrLCSfQxQ3br8DJCoVzhgtPsS2nZZjsBGIZgnU0QpMv+2MnRsnKwdp1VsrCX84j/qvaZn4WhKunippgTbN2EUs0tPTP55Qfgj+nKmjtWW5IYs72FrEwJKYoNfsmqaF4o5pf4v9zgPwVwY/5I4XJKUL2L25m9kAQcW/K+H1RTFEUoj8Z4ajpOmAB/dG0COmCphVMW2CCMvnxhcGiSgPnpDuWu6qiJ7NG7ye5kvHgefgqPLeicspNJ5EpL3XiRNLM2tmJLI1awAwOyd6iHv0dCkMYRKaa6rcaZeYwmKCkckm0kM2JNmnmmAaBQQ7mwmIM0IMxX4f5W6j9PqZWcJxF7r17T/lQBAmcjoupRiJifbnXCNUv9GhpRF19WcBdeKbivRJVlGop6I2RS6lGImJ9udcI1S/0aGlEXX1ZwF14puK9ElWUainojZFYVHLHD6dIP2ESjqBzg3ol1/wB7+/ylGwd9LS7wSZ2A630CJSVKwH47K9P4bB8PEQP8BwjMFa7xQHOqZFP1XqaQ==","base64"))})};import{PublicKey as tl,sendAndConfirmTransaction as nl,SystemProgram as ol,Transaction as sl,TransactionMessage as ul,VersionedTransaction as cl}from"@solana/web3.js";import ml from"axios";import is from"bn.js";var rs=new is(1e6);import{PublicKey as ds}from"@solana/web3.js";import Ei,{isBN as vi}from"bn.js";import{bits as Vl,BitStructure as _l,blob as os,Blob as Dl,cstr as ql,f32 as Gl,f32be as Ul,f64 as Xl,f64be as zl,greedy as Ql,Layout as ss,ns64 as Hl,ns64be as Zl,nu64 as jl,nu64be as Yl,offset as Jl,s16 as $l,s16be as em,s24 as tm,s24be as nm,s32 as as,s32be as im,s40 as rm,s40be as om,s48 as sm,s48be as am,s8 as um,seq as us,struct as cm,Structure as cs,u16 as ls,u16be as lm,u24 as mm,u24be as pm,u32 as dm,u32be as fm,u40 as bm,u40be as ym,u48 as gm,u48be as Pm,u8 as ms,UInt as ps,union as km,Union as Am,unionLayoutDiscriminator as wm,utf8 as Tm}from"@solana/buffer-layout";var On=ss,Ri=cs;var En=ps;var Mi=ms,yt=ls;var ce=as;var Oi=us;var Pe=os;var It=class extends On{constructor(t,n,r){super(t,r);this.blob=Pe(t),this.signed=n}decode(t,n=0){let r=new Ei(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ei(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function _(i){return new En(1,i)}function Fe(i){return new En(4,i)}function k(i){return new It(8,!1,i)}function q(i){return new It(16,!1,i)}function Fi(i){return new It(8,!0,i)}function Wi(i){return new It(16,!0,i)}var rn=class extends On{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new rn(Pe(32),e=>new ds(e),e=>e.toBuffer(),i)}function Ie(i){return new rn(Mi(),fs,bs,i)}function fs(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function bs(i){return i?1:0}var vn=class extends Ri{decode(e,t){return super.decode(e,t)}};function M(i,e,t){return new vn(i,e,t)}function H(i,e,t){let n,r=typeof e=="number"?e:vi(e)?e.toNumber():new Proxy(e,{get(o,a){if(!n){let s=Reflect.get(o,"count");n=vi(s)?s.toNumber():s,Reflect.set(o,"count",n)}return Reflect.get(o,a)},set(o,a,s){return a==="count"&&(n=s),Reflect.set(o,a,s)}});return Oi(i,r,t)}import{PublicKey as Wd}from"@solana/web3.js";import _d from"bn.js";import{AccountLayout as Ud,TOKEN_2022_PROGRAM_ID as Xd,TOKEN_PROGRAM_ID as zd}from"@solana/spl-token";import{PublicKey as Fm}from"@solana/web3.js";import{MintLayout as Vm,TOKEN_PROGRAM_ID as Dm}from"@solana/spl-token";import{Keypair as pn,PublicKey as B,SystemProgram as at,TransactionInstruction as Ke}from"@solana/web3.js";import zn from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as _t,TOKEN_2022_PROGRAM_ID as be,TOKEN_PROGRAM_ID as ie}from"@solana/spl-token";import Bs from"bn.js";import qe from"bn.js";var pe=new qe(0),We=new qe(1),rt=new qe(-1),Ve=new qe(1).shln(64),on=new qe(1).shln(128),Fn=Ve.sub(We),Et=64,Vi=on.subn(1),Ne=-443636,Re=-Ne,Ze=new qe("4295048016"),je=new qe("79226673521066979257578248091"),sn=new qe("4295048017"),an=new qe("79226673521066979257578248090"),_i=16,Di="59543866431248",qi="184467440737095516",Gi="15793534762490258745",un=new qe(10).pow(new qe(6));var $m=new qe("18446744073700000000");import Q from"bn.js";function cn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Wn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Vn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function vt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ui(i,e){return vt(i,e)?null:Wn(i,e)}function Xi(i,e){return vt(i,e)?null:Vn(i,e)}var op=Buffer.from("amm_config","utf8"),ys=Buffer.from("pool","utf8"),gs=Buffer.from("pool_vault","utf8"),Ps=Buffer.from("pool_reward_vault","utf8"),zi=Buffer.from("position","utf8"),ks=Buffer.from("tick_array","utf8"),As=Buffer.from("operation","utf8"),ws=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ts=Buffer.from("observation","utf8");function Qi(i,e,t,n){return Se([ys,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function _n(i,e,t){return Se([gs,e.toBuffer(),t.toBuffer()],i)}function Hi(i,e,t){return Se([Ps,e.toBuffer(),t.toBuffer()],i)}function $(i,e,t){return Se([ks,e.toBuffer(),cn(t)],i)}function ot(i,e,t,n){return Se([zi,e.toBuffer(),cn(t),cn(n)],i)}function Oe(i,e){return Se([zi,e.toBuffer()],i)}function Bt(i){return Se([Buffer.from("metadata","utf8"),ft.toBuffer(),i.toBuffer()],ft)}function ln(i){return Se([As],i)}function ke(i,e){return Se([ws,e.toBuffer()],i)}function Zi(i,e){return Se([Ts,e.toBuffer()],i)}var ji=Buffer.from("locked_position","utf8");function Dn(i,e){return Se([ji,e.toBuffer()],i)}function qn(i,e){return Se([ji,e.toBuffer()],i)}var sp=Buffer.from("support_mint","utf8");import{PublicKey as _e}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Yi}from"@solana/spl-token";import le from"bn.js";import Ye from"bn.js";var Ft=class{static getfeeGrowthInside(e,t,n){let r=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let a=new Ye(0),s=new Ye(0);e.tickCurrent<n.tick?(a=n.feeGrowthOutsideX64A,s=n.feeGrowthOutsideX64B):(a=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),s=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=z.wrappingSubU128(z.wrappingSubU128(e.feeGrowthGlobalX64A,r),a),c=z.wrappingSubU128(z.wrappingSubU128(e.feeGrowthGlobalX64B,o),s);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=z.mulDivFloor(z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),u=t.tokenFeesOwedA.add(s),c=z.mulDivFloor(z.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:a}=this.getfeeGrowthInside(e,n,r),s=z.mulDivFloor(z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ve),u=t.tokenFeesOwedA.add(s),c=z.mulDivFloor(z.wrappingSubU128(a,t.feeGrowthInsideLastX64B),t.liquidity,Ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],a=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=z.wrappingSubU128(u,c.growthInsideLastX64),m=z.mulDivFloor(l,t.liquidity,Ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],a=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let s=0;s<a.length;s++){let u=a[s],c=t.rewardInfos[s],l=z.wrappingSubU128(u,c.growthInsideLastX64),m=z.mulDivFloor(l,t.liquidity,Ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new Ye(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(z.wrappingSubU128(z.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let a=0;a<r.length;a++){let s=new Ye(0);t.liquidityGross.eqn(0)?s=r[a].rewardGrowthGlobalX64:e<t.tick?s=r[a].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[a]):s=t.rewardGrowthsOutsideX64[a];let u=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[a]:u=r[a].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[a])),o.push(z.wrappingSubU128(z.wrappingSubU128(r[a].rewardGrowthGlobalX64,s),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:a}){var b,y,h,T;let s=X.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),u=X.getSqrtPriceX64FromTick(t.tickLower),c=X.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=j.getAmountsFromLiquidity(s,u,c,n,o),[d,p]=[ge(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,a,!0),ge(m.amountB,(y=e.mintB.extensions)==null?void 0:y.feeConfig,a,!0)],[g,f]=[ge(new Ye(new O(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,!0),ge(new Ye(new O(m.amountB.toString()).mul(l).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:it(d.expirationTime,p.expirationTime)}}};var hs=15,Z=class{static async getTickArrays(e,t,n,r,o,a,s){let u=[],c=E.getTickArrayStartIndexByTick(r,o),l=E.getInitializedTickArrayInRange(a,s,o,c,Math.floor(hs/2));for(let p=0;p<l.length;p++){let{publicKey:g}=$(t,n,l[p]);u.push(g)}let m=(await pt(e,u)).map(p=>p!==null?Wt.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]=te(Y({},g),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,a){let{initializedTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,a);for(;s==null||s.liquidityGross.lten(0);){if(c=E.getNextTickArrayStartIndex(c,o,a),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,a);[s,u,c]=[m,d,p]}if(s==null)throw new Error("No invaild tickArray cache");return{nextTick:s,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let a=Math.floor(e/Z.tickCount(t)),s=n?E.searchLowBitFromStart(r,o,a-1,1,t):E.searchHightBitFromStart(r,o,a+1,1,t);return s.length>0?{isExist:!0,nextStartIndex:s[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let s=Te-1;for(;s>=0;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s-1}}else{let s=0;for(;s<Te;){let u=n.ticks[s];if(u.liquidityGross.gtn(0)){o=u;break}s=s+1}}let{publicKey:a}=$(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:a,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,a){let s=E.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-s)/o),c=n[s];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:s};let l;if(a)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<Te;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=$(e,t,s);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(E.checkIsOutOfBoundary(e)){if(e>Re)return!1;let n=E.getTickArrayStartIndexByTick(Ne,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Te*e}};var Gn=14,st=class{static maxTickInTickarrayBitmap(e){return e*Te*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),a=r?t-Z.tickCount(n):t+Z.tickCount(n);if(a<-o||a>=o)return{isInit:!1,tickIndex:t};let s=n*Te,u=a/s+512;a<0&&a%s!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ui(1024,l);if(m!==null){let d=(c-m-512)*s;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Xi(1024,l);if(m!==null){let d=(c+m-512)*s;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Z.tickCount(n)}}}},Vt=class{static getBitmapOffset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=st.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=st.maxTickInTickarrayBitmap(e),n=-t;if(Re<=t)throw Error(`extensionTickBoundary check error: ${Re}, ${t}`);if(n<=Ne)throw Error(`extensionTickBoundary check error: ${n}, ${Ne}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:E.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Z.tickCount(t),a=n?e-o:e+o,{tickarrayBitmap:s}=this.getBitmap(a,t,r);return this.nextInitializedTickArrayInBitmap(s,a,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:a}=st.getBitmapTickBoundary(t,n),s=this.tickArrayOffsetInBitmap(t,n);if(r){let u=E.mergeTickArrayBitmap(e).shln(gt-1-s),c=vt(512,u)?null:Wn(512,u);if(c!==null){let l=t-c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=E.mergeTickArrayBitmap(e).shrn(s),c=vt(512,u)?null:Vn(512,u);if(c!==null){let l=t+c*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:a-Z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%st.maxTickInTickarrayBitmap(t),r=Math.floor(n/Z.tickCount(t));return e<0&&n!=0&&(r=gt-r),r}};var fe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,a=!1){let s=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,s);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:b}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,a);return u.push(...g),{allTrade:d,expectedAmountOut:p.mul(rt),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let a=n.toBase58()===e.mintB.address,s=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,a);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,a);if(f.isExist){let{publicKey:b}=$(e.programId,e.id,f.nextStartIndex);s.push(b)}}catch{}s.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=Pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(rt),c,o);return s.push(...d),{expectedAmountIn:m,remainingAccounts:s,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=fe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Vt.checkTickArrayIsInit(Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):E.checkTickArrayIsInitialized(E.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:s}=$(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:s}}let{isExist:o,nextStartIndex:a}=this.nextInitializedTickArrayStartIndex(e,Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:s}=$(e.programId,e.id,a);return{isExist:!0,startIndex:a,nextAccountMeta:s}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Z.tickCount(e.tickSpacing)),r=t?E.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):E.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=st.nextInitializedTickArrayStartIndex(E.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:a,tickIndex:s}=Vt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(a)return{isExist:!0,nextStartIndex:s};if(t=s,t<Ne||t>Re)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var s,u,c;let a=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(s=t.rewardDefaultInfos[l])==null?void 0:s.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te(Y({},m),{perSecond:z.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new _e(d)});if(p.tokenMint.equals(_e.default))continue;if(n<=p.openTime.toNumber()||r.eq(pe)){a.push(p);continue}let g=new le(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),b=z.mulDivFloor(f,p.emissionsPerSecondX64,r),y=p.rewardGrowthGlobalX64.add(b),h=z.mulDivFloor(f,p.emissionsPerSecondX64,Ve),T=p.rewardTotalEmissioned.add(h);a.push(te(Y({},p),{rewardGrowthGlobalX64:y,rewardTotalEmissioned:T,lastUpdateTime:g}))}return a}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let a=E.getTickArrayStartIndexByTick(o,e);if(a>=n||a<r)return!0}return!1}static tickRange(e){let t=st.maxTickInTickarrayBitmap(e),n=-t;return t>Re&&(t=Z.getArrayStartIndex(Re,e)+Z.tickCount(e)),n<Ne&&(n=Z.getArrayStartIndex(Ne,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Z.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Kt(e,t.map(a=>({pubkey:a})),{batchRequest:n}),o={};for(let a of r)a.accountInfo!==null&&(o[a.pubkey.toString()]=Ji.decode(a.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=E.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=E.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=$(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let a=await Kt(e,o,{batchRequest:n}),s={};for(let u of a){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;s[c.toString()]===void 0&&(s[c.toString()]={});let l=Wt.decode(u.accountInfo.data);s[c.toString()][l.startTickIndex]=te(Y({},l),{address:u.pubkey})}return s}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var s;let a=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(a.find(l=>l.equals(c.state.programId))||a.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of a)c.push(Oe(p,d).publicKey);let l=await pt(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=Un.decode(d.data),g=p.poolId.toString(),f=e.find(R=>R.state.id.toBase58()===g);if(f===void 0)continue;let b=f.state,y=E._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),h=E._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:T,amountB:N}=j.getAmountsFromLiquidity(b.sqrtPriceX64,y.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),v=1/(1-Math.sqrt(Math.sqrt(y.price.div(h.price).toNumber())));f.positionAccount=[...(s=f.positionAccount)!=null?s:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:y.price,priceUpper:h.price,amountA:T,amountB:N,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(R=>te(Y({},R),{pendingReward:new le(0)})),leverage:v,tokenFeeAmountA:new le(0),tokenFeeAmountB:new le(0)}];let I=await E.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),L=await E.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=I,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=L}if(o){let d=Object.values(m),p=await pt(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let y=d[f].toString();g[y]=Wt.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let y of b){let h=`${f.programId.toString()}-${f.id.toString()}-${y.tickLower}`,T=`${f.programId.toString()}-${f.id.toString()}-${y.tickUpper}`,N=g[m[h].toString()],v=g[m[T].toString()],I=N.ticks[E.getTickOffsetInArray(y.tickLower,f.tickSpacing)],L=v.ticks[E.getTickOffsetInArray(y.tickUpper,f.tickSpacing)],{tokenFeeAmountA:R,tokenFeeAmountB:D}=await Ft.GetPositionFees(f,y,I,L),x=await Ft.GetPositionRewards(f,y,I,L);y.tokenFeeAmountA=R.gte(new le(0))?R:new le(0),y.tokenFeeAmountB=D.gte(new le(0))?D:new le(0);for(let F=0;F<x.length;F++)y.rewardInfos[F].pendingReward=x[F].gte(new le(0))?x[F]:new le(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:a,priceLimit:s=new O(0),catchLiquidityInsufficient:u=!1}){var ye;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];s.equals(new O(0))?c=l?Ze.add(new le(1)):je.sub(new le(1)):c=X.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let p=ge(o,m,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:b,executionPrice:y,feeAmount:h}=fe.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((ye=p.fee)!=null?ye:pe),c,u),T=ge(f,d,r,!1),N=X.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),v=l?N:new O(1).div(N),I=f.mul(new le(Math.floor((1-a)*1e10))).div(new le(1e10)),L=ge(I,d,r,!1),R=l?e.currentPrice:new O(1).div(e.currentPrice),D=new O(v).sub(R).abs(),x=R,F=new tt(new O(D).mul(10**15).toFixed(0),new O(x).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:T,minAmountOut:L,expirationTime:it(p.expirationTime,T.expirationTime),currentPrice:e.currentPrice,executionPrice:v,priceImpact:F,fee:h,remainingAccounts:b,executionPriceX64:y}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:a,catchLiquidityInsufficient:s=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Xe(te(Y({},c),{mint:c.address,isToken2022:c.programId===Yi.toBase58()})),new Xe(te(Y({},l),{mint:l.address,isToken2022:l.programId===Yi.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:b,expirationTime:y,currentPrice:h,executionPrice:T,priceImpact:N,fee:v,remainingAccounts:I,executionPriceX64:L}=fe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new _e(c.address),amountIn:n,slippage:o,epochInfo:a,catchLiquidityInsufficient:s}),R=te(Y({},g),{amount:new we(m,g.amount),fee:g.fee===void 0?void 0:new we(m,g.fee)}),D=te(Y({},f),{amount:new we(d,f.amount),fee:f.fee===void 0?void 0:new we(d,f.fee)}),x=te(Y({},b),{amount:new we(d,b.amount),fee:b.fee===void 0?void 0:new we(d,b.fee)}),F=new Ee({baseToken:m,denominator:new le(10).pow(new le(20+m.decimals)),quoteToken:d,numerator:h.mul(new O(10**(20+d.decimals))).toFixed(0)}),ye=new Ee({baseToken:m,denominator:new le(10).pow(new le(20+m.decimals)),quoteToken:d,numerator:T.mul(new O(10**(20+d.decimals))).toFixed(0)}),se=new we(m,v);return{allTrade:p,realAmountIn:R,amountOut:D,minAmountOut:x,expirationTime:y,currentPrice:F,executionPrice:ye,priceImpact:N,fee:se,remainingAccounts:I,executionPriceX64:L}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:a,priceLimit:s=new O(0)}){var x;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;s.equals(new O(0))?l=u?je.sub(new le(1)):Ze.add(new le(1)):l=X.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let m=ge(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:g,feeAmount:f}=fe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((x=m.fee)!=null?x:pe),l),b=u?e.mintB.address:e.mintA.address,y=ge(d,c[b],r,!1),h=X.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),T=u?h:new O(1).div(h),N=d.mul(new le(Math.floor((1+a)*1e10))).div(new le(1e10)),v=ge(N,c[b],r,!0),I=u?e.currentPrice:new O(1).div(e.currentPrice),L=new O(T).sub(I).abs(),R=I,D=new tt(new O(L).mul(10**15).toFixed(0),new O(R).mul(10**15).toFixed(0));return{amountIn:y,maxAmountIn:v,realAmountOut:m,expirationTime:it(y.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:D,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,b;let o=e[t],a=E.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),s=E.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(a,o.priceMin),l=Math.min(s,o.priceMax)-u,m=s-a,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((b=o.rewardApr[2])!=null?b:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:a,positionTickUpperIndex:s,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[ht(e.mintA.address).toString()],d=r[ht(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=X.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),b=X.getSqrtPriceX64FromTick(a),y=X.getSqrtPriceX64FromTick(s),{amountSlippageA:h,amountSlippageB:T}=j.getAmountsFromLiquidityWithSlippage(f,b,y,t,!1,!1,0),{amountSlippageA:N,amountSlippageB:v}=j.getAmountsFromLiquidityWithSlippage(f,b,y,o,!1,!1,0),I=new O(h.toString()).div(new O(10).pow(p)).mul(m.value).add(new O(T.toString()).div(new O(10).pow(g)).mul(d.value)),L=new O(N.toString()).div(new O(10).pow(p)).mul(m.value).add(new O(v.toString()).div(new O(10).pow(g)).mul(d.value)),R=new O(1).div(I.add(L)),x=new O(l.volumeFee).mul(365).div(c).mul(R).mul(100).toNumber(),F=3600*24*365,ye=e.rewardDefaultInfos.map(se=>{var ee,ei;let he=se.mint.decimals,de=r[se.mint.address];return u<((ee=se.startTime)!=null?ee:0)||u>((ei=se.endTime)!=null?ei:0)||!se.perSecond||!de||he===void 0?0:new O(de.value).mul(new O(se.perSecond).mul(F)).div(new O(10).pow(he)).mul(R).mul(100).toNumber()});return{feeApr:x,rewardsApr:ye,apr:x+ye.reduce((se,he)=>se+he,0)}}static async getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:a,add:s,epochInfo:u,amountHasFee:c}){var y,h;let l=X.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),m=X.getSqrtPriceX64FromTick(n),d=X.getSqrtPriceX64FromTick(r),p=ge(o,(y=e[t?"mintA":"mintB"].extensions)==null?void 0:y.feeConfig,u,!c),g=new le(new O(p.amount.sub((h=p.fee)!=null?h:pe).toString()).toFixed(0)),f;if(l.lte(m))f=t?j.getLiquidityFromTokenAmountA(m,d,g,!s):new le(0);else if(l.lte(d)){let T=j.getLiquidityFromTokenAmountA(l,d,g,!s),N=j.getLiquidityFromTokenAmountB(m,l,g);f=t?T:N}else f=t?new le(0):j.getLiquidityFromTokenAmountB(m,d,g);let b=await fe.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:f,slippage:a,add:s});return{liquidity:f,amountA:t?p:b.amountA,amountB:t?b.amountB:p,amountSlippageA:t?p:b.amountSlippageA,amountSlippageB:t?b.amountSlippageB:p,expirationTime:b.expirationTime}}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:a,add:s}){var b,y,h,T;let u=X.getSqrtPriceX64FromTick(n),c=X.getSqrtPriceX64FromTick(r),l=s?1+a:1-a,m=j.getAmountsFromLiquidity(X.priceToSqrtPriceX64(new O(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,s),[d,p]=[ge(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ge(m.amountB,(y=t.mintB.extensions)==null?void 0:y.feeConfig,e,!0)],[g,f]=[ge(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ge(m.amountB.muln(l),(T=t.mintB.extensions)==null?void 0:T.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:it(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new _e(u.id));(await pt(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=mn.decode(u.data))});let a=t.map(u=>ke(new _e(u.programId),new _e(u.id)).publicKey),s=await fe.fetchExBitmaps({connection:e,exBitmapAddress:a,batchRequest:!1});return t.reduce((u,c)=>te(Y({},u),{[c.id]:te(Y({},n[c.id]),{id:new _e(c.id),version:6,programId:new _e(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te(Y({},c.config),{id:new _e(c.config.id),fundOwner:""}),currentPrice:new O(c.price),exBitmapAccount:ke(new _e(c.programId),new _e(c.id)).publicKey,exBitmapInfo:s[ke(new _e(c.programId),new _e(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var z=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(pe)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(pe))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new O(e.toString()).div(O.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Q(e.mul(O.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(on).sub(t).mod(on)}};function Be(i,e){return Xn(i.mul(e),64,256)}function Is(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Xn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var X=class{static sqrtPriceX64ToPrice(e,t,n){return z.x64ToDecimal(e).pow(2).mul(O.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return z.decimalToX64(e.mul(O.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(pe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(pe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(pe))return e;let o=t.shln(Et);if(r){let a=o,s=o.add(n.mul(e));return s.gte(a)?z.mulDivCeil(a,e,s):z.mulDivRoundingUp(a,We,a.div(e).add(n))}else{let a=n.mul(e);if(!o.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let s=o.sub(a);return z.mulDivCeil(o,e,s)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Et);if(r)return e.add(o.div(t));{let a=z.mulDivRoundingUp(o,We,t);if(!e.gt(a))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(a)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ne||e>Re)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Q("18445821805675395072"):new Q("18446744073709551616");return(t&2)!=0&&(n=Be(n,new Q("18444899583751176192"))),(t&4)!=0&&(n=Be(n,new Q("18443055278223355904"))),(t&8)!=0&&(n=Be(n,new Q("18439367220385607680"))),(t&16)!=0&&(n=Be(n,new Q("18431993317065453568"))),(t&32)!=0&&(n=Be(n,new Q("18417254355718170624"))),(t&64)!=0&&(n=Be(n,new Q("18387811781193609216"))),(t&128)!=0&&(n=Be(n,new Q("18329067761203558400"))),(t&256)!=0&&(n=Be(n,new Q("18212142134806163456"))),(t&512)!=0&&(n=Be(n,new Q("17980523815641700352"))),(t&1024)!=0&&(n=Be(n,new Q("17526086738831433728"))),(t&2048)!=0&&(n=Be(n,new Q("16651378430235570176"))),(t&4096)!=0&&(n=Be(n,new Q("15030750278694412288"))),(t&8192)!=0&&(n=Be(n,new Q("12247334978884435968"))),(t&16384)!=0&&(n=Be(n,new Q("8131365268886854656"))),(t&32768)!=0&&(n=Be(n,new Q("3584323654725218816"))),(t&65536)!=0&&(n=Be(n,new Q("696457651848324352"))),(t&131072)!=0&&(n=Be(n,new Q("26294789957507116"))),(t&262144)!=0&&(n=Be(n,new Q("37481735321082"))),e>0&&(n=Vi.div(n)),n}static getTickFromPrice(e,t,n){return X.getTickFromSqrtPriceX64(X.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(je)||e.lt(Ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Q(t-64),r=Is(n,32,128),o=new Q("8000000000000000","hex"),a=0,s=new Q(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Q(0))&&a<_i;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),s=s.add(o.mul(g)),o=o.shrn(1),a+=1}let c=s.shrn(32),m=r.add(c).mul(new Q(Di)),d=Xn(m.sub(new Q(qi)),64,128).toNumber(),p=Xn(m.add(new Q(Gi)),64,128).toNumber();return d==p?d:X.getSqrtPriceX64FromTick(p).lte(e)?p:d}},kt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let a=X.getTickFromSqrtPriceX64(X.priceToSqrtPriceX64(e,n,r))/t;return a<0?a=Math.floor(a):a=Math.ceil(a),a*t}static roundPriceWithTickspacing(e,t,n,r){let o=kt.getTickWithPriceAndTickspacing(e,t,n,r),a=X.getSqrtPriceX64FromTick(o);return X.sqrtPriceX64ToPrice(a,n,r)}},j=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Et),a=t.sub(e);return r?z.mulDivRoundingUp(z.mulDivCeil(o,a,t),We,e):z.mulDivFloor(o,a,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(pe))throw new Error("sqrtPriceX64A must greater than 0");return r?z.mulDivCeil(n,t.sub(e),Ve):z.mulDivFloor(n,t.sub(e),Ve)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),a=t.sub(e),s=o.div(a);return r?z.mulDivRoundingUp(s,We,Fn):s.shrn(Et)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),z.mulDivFloor(n,Fn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return j.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let a=j.getLiquidityFromTokenAmountA(e,n,r,!1),s=j.getLiquidityFromTokenAmountB(t,e,o);return a.lt(s)?a:s}else return j.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:j.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new Q(0)};if(e.lt(n)){let a=j.getTokenAmountAFromLiquidity(e,n,r,o),s=j.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:a,amountB:s}}else return{amountA:new Q(0),amountB:j.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,a,s){let{amountA:u,amountB:c}=j.getAmountsFromLiquidity(e,t,n,r,a),l=o?1+s:1-s,m=new Q(new O(u.toString()).mul(l).toFixed(0)),d=new Q(new O(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:a,epochInfo:s,amountAddFee:u}){var h,T,N,v;let c=X.priceToSqrtPriceX64(new O(e.price),e.mintA.decimals,e.mintB.decimals),l=X.getSqrtPriceX64FromTick(t),m=X.getSqrtPriceX64FromTick(n),d=a?1+o:1-o,p=j.getAmountsFromLiquidity(c,l,m,r,a),[g,f]=[ge(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,u),ge(p.amountB,(T=e.mintB.extensions)==null?void 0:T.feeConfig,s,u)],[b,y]=[ge(new Q(new O(p.amountA.toString()).mul(d).toFixed(0)),(N=e.mintA.extensions)==null?void 0:N.feeConfig,s,u),ge(new Q(new O(p.amountB.toString()).mul(d).toFixed(0)),(v=e.mintB.extensions)==null?void 0:v.feeConfig,s,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:b,amountSlippageB:y,expirationTime:it(g.expirationTime,f.expirationTime)}}},Pt=class{static swapCompute(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f=!1){if(d.eq(pe))throw new Error("amountSpecified must not be 0");if(g||(g=a?Ze.add(We):je.sub(We)),a){if(g.lt(Ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(je))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let b=d.gt(pe),y={amountSpecifiedRemaining:d,amountCalculated:pe,sqrtPriceX64:m,tick:c>p?Math.min(p+Z.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new Q(0)},h=p,T=n[p],N=0,v=!a&&T.startTickIndex===y.tick;for(;!y.amountSpecifiedRemaining.eq(pe)&&!y.sqrtPriceX64.eq(g);){N>10;let I={};I.sqrtPriceStartX64=y.sqrtPriceX64;let L=E.nextInitTick(T,y.tick,l,a,v),R=L||null,D=null;if(!(R!=null&&R.liquidityGross.gtn(0))){let F=fe.nextInitializedTickArrayStartIndex({tickCurrent:y.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,a);if(!F.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:y.amountSpecifiedRemaining,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts};throw Error("swapCompute LiquidityInsufficient")}h=F.nextStartIndex;let{publicKey:ye}=$(e,t,h);D=ye,T=n[h];try{R=E.firstInitializedTick(T,a)}catch{throw Error("not found next tick info")}}I.tickNext=R.tick,I.initialized=R.liquidityGross.gtn(0),p!==h&&D&&(y.accounts.push(D),p=h),I.tickNext<Ne?I.tickNext=Ne:I.tickNext>Re&&(I.tickNext=Re),I.sqrtPriceNextX64=X.getSqrtPriceX64FromTick(I.tickNext);let x;if(a&&I.sqrtPriceNextX64.lt(g)||!a&&I.sqrtPriceNextX64.gt(g)?x=g:x=I.sqrtPriceNextX64,[y.sqrtPriceX64,I.amountIn,I.amountOut,I.feeAmount]=Pt.swapStepCompute(y.sqrtPriceX64,x,y.liquidity,y.amountSpecifiedRemaining,s,a),y.feeAmount=y.feeAmount.add(I.feeAmount),b?(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.sub(I.amountIn.add(I.feeAmount)),y.amountCalculated=y.amountCalculated.sub(I.amountOut)):(y.amountSpecifiedRemaining=y.amountSpecifiedRemaining.add(I.amountOut),y.amountCalculated=y.amountCalculated.add(I.amountIn.add(I.feeAmount))),y.sqrtPriceX64.eq(I.sqrtPriceNextX64)){if(I.initialized){let F=R.liquidityNet;a&&(F=F.mul(rt)),y.liquidity=j.addDelta(y.liquidity,F)}v=I.tickNext!=y.tick&&!a&&T.startTickIndex===I.tickNext,y.tick=a?I.tickNext-1:I.tickNext}else if(y.sqrtPriceX64!=I.sqrtPriceStartX64){let F=X.getTickFromSqrtPriceX64(y.sqrtPriceX64);v=F!=y.tick&&!a&&T.startTickIndex===F,y.tick=F}++N}try{let{nextStartIndex:I,isExist:L}=Z.nextInitializedTickArray(y.tick,l,a,r,o);L&&p!==I&&(y.accounts.push($(e,t,I).publicKey),p=I)}catch{}return{allTrade:!0,amountSpecifiedRemaining:pe,amountCalculated:y.amountCalculated,feeAmount:y.feeAmount,sqrtPriceX64:y.sqrtPriceX64,liquidity:y.liquidity,tickCurrent:y.tick,accounts:y.accounts}}static swapStepCompute(e,t,n,r,o,a){let s={sqrtPriceX64Next:new Q(0),amountIn:new Q(0),amountOut:new Q(0),feeAmount:new Q(0)},u=r.gte(pe);if(u){let l=z.mulDivFloor(r,un.sub(new Q(o.toString())),un);s.amountIn=a?j.getTokenAmountAFromLiquidity(t,e,n,!0):j.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=X.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?j.getTokenAmountBFromLiquidity(t,e,n,!1):j.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(rt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=X.getNextSqrtPriceX64FromOutput(e,n,r.mul(rt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=j.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=j.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:j.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:j.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(rt))&&(s.amountOut=r.mul(rt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=z.mulDivCeil(s.amountIn,new Q(o),un.sub(new Q(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Te=60,gt=512,E=class{static getTickArrayAddressByTick(e,t,n,r){let o=E.getTickArrayStartIndexByTick(n,r),{publicKey:a}=$(e,t,o);return a}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=E.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=Te)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Te,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*Te,o=Math.floor(t/r)+512,a=Math.abs(o);return{isInitialized:e.testn(a),startIndex:(a-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Te:e+t*Te}static mergeTickArrayBitmap(e){let t=new Bs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let a=Math.floor(r/(n*Te));return[...E.searchLowBitFromStart(e,t,a-1,o,n),...E.searchHightBitFromStart(e,t,a,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return E.searchHightBitFromStart(e,t,-7680,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let a=[],s=E.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of s){let{publicKey:c}=$(e,t,u);a.push({tickArrayStartIndex:u,tickArrayAddress:c})}return a}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>E.mergeTickArrayBitmap(c)),s=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n--,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let a=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>E.mergeTickArrayBitmap(c)),s=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(a[c].testn(l)&&s.push(n),n++,s.length===r)break}let u=Z.tickCount(o);return s.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Ne||e>Re}static nextInitTick(e,t,n,r,o){if(Z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let s=Math.floor((t-e.startTickIndex)/n);if(r)for(;s>=0;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s-1}else for(o||(s=s+1);s<Te;){if(e.ticks[s].liquidityGross.gtn(0))return e.ticks[s];s=s+1}return null}static firstInitializedTick(e,t){if(t){let n=Te-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Te;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=X.getSqrtPriceX64FromTick(t),o=X.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new O(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new O(1).div(t),o=kt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=X.getSqrtPriceX64FromTick(o),s=X.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new O(1).div(s)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=X.getSqrtPriceX64FromTick(t),o=X.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new O(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new O(1).div(t),o=kt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),a=X.getSqrtPriceX64FromTick(o),s=X.sqrtPriceX64ToPrice(a,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:s}:{tick:o,price:new O(1).div(s)}}};var xs=M([Pe(8),_("bump"),yt("index"),S(""),Fe("protocolFeeRate"),Fe("tradeFeeRate"),yt("tickSpacing"),H(k(),8,"")]),Ss=M([Fe("blockTimestamp"),Fi("tickCumulative"),H(k(),4)]),$i=M([Pe(8),Ie("initialized"),k("recentEpoch"),yt("observationIndex"),S("poolId"),H(Ss,100,"observations"),H(k(),4)]),Ks=M([_("rewardState"),k("openTime"),k("endTime"),k("lastUpdateTime"),q("emissionsPerSecondX64"),k("rewardTotalEmissioned"),k("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),q("rewardGrowthGlobalX64")]),mn=M([Pe(8),_("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),_("mintDecimalsA"),_("mintDecimalsB"),yt("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),ce("tickCurrent"),Fe(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),k("protocolFeesTokenA"),k("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),_("status"),H(_(),7,""),H(Ks,3,"rewardInfos"),H(k(),16,"tickArrayBitmap"),k("totalFeesTokenA"),k("totalFeesClaimedTokenA"),k("totalFeesTokenB"),k("totalFeesClaimedTokenB"),k("fundFeesTokenA"),k("fundFeesTokenB"),k("startTime"),H(k(),15*4-3,"padding")]),Cs=M([q("growthInsideLastX64"),k("rewardAmountOwed")]),Un=M([Pe(8),_("bump"),S("nftMint"),S("poolId"),ce("tickLower"),ce("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),H(Cs,3,"rewardInfos"),H(k(),8,"")]),fd=M([Pe(8),_("bump"),S("poolId"),ce("tickLowerIndex"),ce("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),k("tokenFeesOwedA"),k("tokenFeesOwedB"),H(q(),3,"rewardGrowthInside"),H(k(),8,"")]),Ns=M([ce("tick"),Wi("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),H(q(),3,"rewardGrowthsOutsideX64"),H(Fe(),13,"")]),Wt=M([Pe(8),S("poolId"),ce("startTickIndex"),H(Ns,Te,"ticks"),_("initializedTickCount"),H(_(),115,"")]),Ls=M([Pe(329),H(S(),100,"whitelistMints")]),Ji=M([Pe(8),S("poolId"),H(H(k(),8),Gn,"positiveTickArrayBitmap"),H(H(k(),8),Gn,"negativeTickArrayBitmap")]),bd=M([k(),_("bump"),S("owner"),S("poolId"),S("positionId"),S("nftAccount"),H(k(),8)]),yd=M([Pe(8),_("bump"),S("lockOwner"),S("poolId"),S("positionId"),S("nftAccount"),S("lockNftMint"),k("recentEpoch"),H(k(),8)]);$i.span;var er=ae("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],openPositionWithTokenEx:[77,255,174,82,125,29,201,46],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},tr=[188,37,179,131,82,150,84,73],nr=[16,72,250,198,14,162,212,19],At=class{static createPoolInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g){let f=M([q("sqrtPriceX64"),k("zero")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},...(g==null?void 0:g.map(T=>({pubkey:T,isSigner:!1,isWritable:!1})))||[]],y=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,zero:pe},y);let h=Buffer.from([...De.createPool,...y]);return new Ke({keys:b,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:a,initialPriceX64:s,extendMintAccount:u}=e,[c,l]=[new B(r.address),new B(o.address)],{publicKey:m}=Qi(t,a,c,l),{publicKey:d}=Zi(t,m),{publicKey:p}=_n(t,m,c),{publicKey:g}=_n(t,m,l),f=ke(t,m).publicKey,b=[this.createPoolInstruction(t,m,n,a,d,c,p,new B(r.programId||ie),l,g,new B(o.programId||ie),f,s,u)];return{signers:[],instructions:b,instructionTypes:[ne.CreateAccount,ne.ClmmCreatePool],address:{poolId:m,observationId:d,exBitmapAccount:f,mintAVault:p,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h,T,N,v,I,L,R,D,x){let F=M([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),_("optionBaseFlag"),Ie("baseFlag")]),ye=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],he=Buffer.alloc(F.span);F.encode({tickLowerIndex:h,tickUpperIndex:T,tickArrayLowerStartIndex:N,tickArrayUpperStartIndex:v,liquidity:I,amountMaxA:L,amountMaxB:R,withMetadata:D==="create",baseFlag:!1,optionBaseFlag:0},he);let de=Buffer.from([...De.openPosition,...he]);return new Ke({keys:se,programId:e,data:de})}static openPositionFromLiquidityInstruction22(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h,T,N,v,I,L,R,D){let x=M([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),_("optionBaseFlag"),Ie("baseFlag")]),F=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...F],se=Buffer.alloc(x.span);x.encode({tickLowerIndex:y,tickUpperIndex:h,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:N,liquidity:v,amountMaxA:I,amountMaxB:L,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},se);let he=Buffer.from([...De.openPositionWithTokenEx,...se]);return new Ke({keys:ye,programId:e,data:he})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[p,g]=[new B(e.programId),new B(e.id)],f;if(l)f=new B((await l(1))[0]);else{let D=pn.generate();d.push(D),f=D.publicKey}let b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=$(p,g,b),{publicKey:T}=$(p,g,y),{publicKey:N}=m?re(n.wallet,f,be):re(n.wallet,f,ie),{publicKey:v}=Bt(f),{publicKey:I}=Oe(p,f),{publicKey:L}=ot(p,g,r,o),R=m?this.openPositionFromLiquidityInstruction22(p,n.feePayer,g,n.wallet,f,N,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,y,a,s,u,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(p,g).publicKey:void 0):this.openPositionFromLiquidityInstruction(p,n.feePayer,g,n.wallet,f,N,v,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,y,a,s,u,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(p,g).publicKey:void 0);return{signers:d,instructions:[R],instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:h,tickArrayUpper:T,positionNftAccount:N,metadataAccount:v,personalPosition:I,protocolPosition:L}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:a,baseAmount:s,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d=[],[p,g]=[new B(e.programId),new B(e.id)],f;if(l)f=new B((await l(1))[0]);else{let D=pn.generate();d.push(D),f=D.publicKey}let b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=$(p,g,b),{publicKey:T}=$(p,g,y),{publicKey:N}=m?re(n.wallet,f,be):re(n.wallet,f,ie),{publicKey:v}=Bt(f),{publicKey:I}=Oe(p,f),{publicKey:L}=ot(p,g,r,o),R=m?this.openPositionFromBaseInstruction22(p,n.feePayer,g,n.wallet,f,N,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,y,c,a,s,u,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(p,g).publicKey:void 0):this.openPositionFromBaseInstruction(p,n.feePayer,g,n.wallet,f,N,v,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),r,o,b,y,c,a,s,u,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(p,g).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:h,tickArrayUpper:T,positionNftAccount:N,metadataAccount:v,personalPosition:I,protocolPosition:L},instructions:[R],signers:d,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h,T,N,v,I,L,R,D,x){let F=M([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),_("optionBaseFlag"),Ie("baseFlag")]),ye=[...x?[{pubkey:x,isSigner:!1,isWritable:!0}]:[]],se=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...ye],he=Buffer.alloc(F.span);F.encode({tickLowerIndex:h,tickUpperIndex:T,tickArrayLowerStartIndex:N,tickArrayUpperStartIndex:v,liquidity:new zn(0),amountMaxA:L==="MintA"?R:D,amountMaxB:L==="MintA"?D:R,withMetadata:I==="create",baseFlag:L==="MintA",optionBaseFlag:1},he);let de=Buffer.from([...De.openPosition,...he]);return new Ke({keys:se,programId:e,data:de})}static openPositionFromBaseInstruction22(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h,T,N,v,I,L,R,D){let x=M([ce("tickLowerIndex"),ce("tickUpperIndex"),ce("tickArrayLowerStartIndex"),ce("tickArrayUpperStartIndex"),q("liquidity"),k("amountMaxA"),k("amountMaxB"),Ie("withMetadata"),_("optionBaseFlag"),Ie("baseFlag")]),F=[...D?[{pubkey:D,isSigner:!1,isWritable:!0}]:[]],ye=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...F],se=Buffer.alloc(x.span);x.encode({tickLowerIndex:y,tickUpperIndex:h,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:N,liquidity:new zn(0),amountMaxA:I==="MintA"?L:R,amountMaxB:I==="MintA"?R:L,withMetadata:v==="create",baseFlag:I==="MintA",optionBaseFlag:1},se);let he=Buffer.from([...De.openPositionWithTokenEx,...se]);return new Ke({keys:ye,programId:e,data:he})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:a,amountMaxA:s,amountMaxB:u,withMetadata:c,getEphemeralSigners:l,nft2022:m}){let d,p=[];if(l)d=new B((await l(1))[0]);else{let D=pn.generate();p.push(D),d=D.publicKey}let[g,f]=[new B(e.programId),new B(e.id)],b=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:h}=$(g,f,b),{publicKey:T}=$(g,f,y),{publicKey:N}=m?re(n.wallet,d,be):re(n.wallet,d,ie),{publicKey:v}=Bt(d),{publicKey:I}=Oe(g,d),{publicKey:L}=ot(g,f,r,o),R=m?this.openPositionFromLiquidityInstruction22(g,n.wallet,f,n.wallet,d,N,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,b,y,a,s,u,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(g,f).publicKey:void 0):this.openPositionFromLiquidityInstruction(g,n.wallet,f,n.wallet,d,N,v,L,h,T,I,n.tokenAccountA,n.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(t.mintA.address),new B(t.mintB.address),r,o,b,y,a,s,u,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?ke(g,f).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:h,tickArrayUpper:T,positionNftAccount:N,metadataAccount:v,personalPosition:I,protocolPosition:L},instructions:[R],signers:p,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o,a){let s=M([]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:a?be:ie,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let l=Buffer.from([...De.closePosition,...c]);return new Ke({keys:u,programId:e,data:l})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r,nft2022:o}){let a=new B(e.programId),s=o?re(n.wallet,r.nftMint,be).publicKey:re(n.wallet,r.nftMint,ie).publicKey,{publicKey:u}=Oe(a,r.nftMint),c=[];return c.push(this.closePositionInstruction(a,n.wallet,r.nftMint,s,u,o)),{address:{positionNftAccount:s,personalPosition:u},signers:[],instructions:c,instructionTypes:[ne.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h){let T=M([q("liquidity"),k("amountMaxA"),k("amountMaxB"),_("optionBaseFlag"),Ie("baseFlag")]),N=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...N],I=Buffer.alloc(T.span);T.encode({liquidity:f,amountMaxA:b,amountMaxB:y,optionBaseFlag:0,baseFlag:!1},I);let L=Buffer.from([...De.increaseLiquidity,...I]);return new Ke({keys:v,programId:e,data:L})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:a,amountMaxB:s,nft2022:u}){let[c,l]=[new B(e.programId),new B(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=$(c,l,m),{publicKey:g}=$(c,l,d),{publicKey:f}=u?re(r.wallet,n.nftMint,be):re(r.wallet,n.nftMint,ie),{publicKey:b}=Oe(c,n.nftMint),{publicKey:y}=ot(c,l,n.tickLower,n.tickUpper),h=this.increasePositionFromLiquidityInstruction(c,r.wallet,f,b,l,y,p,g,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,a,s,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ke(c,l).publicKey:void 0);return{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:y},signers:[],instructions:[h],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:a,otherAmountMax:s,nft2022:u}){let[c,l]=[new B(e.programId),new B(e.id)],m=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=$(c,l,m),{publicKey:g}=$(c,l,d),{publicKey:f}=u?re(r.wallet,n.nftMint,be):re(r.wallet,n.nftMint,ie),{publicKey:b}=Oe(c,n.nftMint),{publicKey:y}=ot(c,l,n.tickLower,n.tickUpper);return{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:b,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,f,b,l,y,p,g,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),o,a,s,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?ke(c,l).publicKey:void 0)],signers:[],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h){let T=M([q("liquidity"),k("amountMaxA"),k("amountMaxB"),_("optionBaseFlag"),Ie("baseFlag")]),N=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],v=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...N],I=Buffer.alloc(T.span);T.encode({liquidity:new zn(0),amountMaxA:f==="MintA"?b:y,amountMaxB:f==="MintA"?y:b,baseFlag:f==="MintA",optionBaseFlag:1},I);let L=Buffer.from([...De.increaseLiquidity,...I]);return new Ke({keys:v,programId:e,data:L})}static decreaseLiquidityInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y,h,T){let N=M([q("liquidity"),k("amountMinA"),k("amountMinB")]),v=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[],...f.map(D=>[{pubkey:D.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:D.rewardMint,isSigner:!1,isWritable:!1}]).flat()],I=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...v],L=Buffer.alloc(N.span);N.encode({liquidity:b,amountMinA:y,amountMinB:h},L);let R=Buffer.from([...De.decreaseLiquidity,...L]);return new Ke({keys:I,programId:e,data:R})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:a,amountMinB:s,programId:u,nft2022:c}){let[l,m]=[new B(e.programId),new B(e.id)],d=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),p=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:g}=$(l,m,d),{publicKey:f}=$(l,m,p),{publicKey:b}=c?re(r.wallet,n.nftMint,be):re(r.wallet,n.nftMint,u),{publicKey:y}=Oe(l,n.nftMint),{publicKey:h}=ot(l,m,n.tickLower,n.tickUpper),T=[];for(let I=0;I<e.rewardDefaultInfos.length;I++)T.push({poolRewardVault:new B(t.rewardInfos[I].vault),ownerRewardVault:r.rewardAccounts[I],rewardMint:new B(e.rewardDefaultInfos[I].mint.address)});let N=[],v=this.decreaseLiquidityInstruction(l,r.wallet,b,y,m,h,g,f,r.tokenAccountA,r.tokenAccountB,new B(t.vault.A),new B(t.vault.B),new B(e.mintA.address),new B(e.mintB.address),T,o,a,s,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,p])?ke(l,m).publicKey:void 0);return N.push(v),{address:{tickArrayLower:g,tickArrayUpper:f,positionNftAccount:b,personalPosition:y,protocolPosition:h},signers:[],instructions:N,instructionTypes:[ne.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,a,s,u,c,l,m,d,p,g,f,b,y){let h=M([k("amount"),k("otherAmountThreshold"),q("sqrtPriceLimitX64"),Ie("isBaseInput")]),T=[...y?[{pubkey:y,isSigner:!1,isWritable:!0}]:[],...m.map(L=>({pubkey:L,isSigner:!1,isWritable:!0}))],N=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...T],v=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:b},v);let I=Buffer.from([...De.swap,...v]);return new Ke({keys:N,programId:e,data:I})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:a,amountOutMin:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new B(e.programId),new B(e.id)],[d,p]=[new B(t.vault.A),new B(t.vault.B)],[g,f]=[new B(e.mintA.address),new B(e.mintB.address)],b=e.mintA.address===o.toString(),y=[this.swapInstruction(l,r.wallet,m,new B(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?d:p,b?p:d,b?g:f,b?f:g,c,n,a,s,u,!0,ke(l,m).publicKey)];return{signers:[],instructions:y,instructionTypes:[ne.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:a,amountInMax:s,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new B(e.programId),new B(e.id)],[d,p]=[new B(t.vault.A),new B(t.vault.B)],[g,f]=[new B(e.mintA.address),new B(e.mintB.address)],b=e.mintA.address===o.toBase58(),y=[this.swapInstruction(l,r.wallet,m,new B(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?p:d,b?d:p,b?f:g,b?g:f,c,n,a,s,u,!1,ke(l,m).publicKey)];return{signers:[],instructions:y,instructionTypes:[ne.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,a,s,u,c,l,m,d){let p=M([k("openTime"),k("endTime"),q("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ue(l),endTime:ue(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...De.initReward,...f]);return new Ke({keys:g,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new B(e.programId),new B(e.id)],s=Hi(o,a,r.mint).publicKey,u=ln(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,a,u,new B(e.config.id),n.tokenAccount,r.programId,r.mint,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:s,operationId:u},signers:[],instructions:c,instructionTypes:[ne.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,a,s,u,c,l,m,d){let p=M([_("rewardIndex"),q("emissionsPerSecondX64"),k("openTime"),k("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ue(l),endTime:ue(m)},f);let b=Buffer.from([...De.setRewardEmissions,...f]);return new Ke({keys:g,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,a]=[new B(e.programId),new B(e.id)],s,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(s=d,u=new B(t.rewardInfos[d].vault),c=new B(t.rewardInfos[d].mint.address));(s===void 0||u===void 0)&&er.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=ln(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,a,l,new B(e.config.id),n.tokenAccount,u,c,s,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ne.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,a,s){let u=M([_("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:$t,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:s},l);let m=Buffer.from([...De.collectReward,...l]);return new Ke({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,a]=[new B(e.programId),new B(e.id)],s,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(s=l,u=new B(t.rewardInfos[l].vault));(s===void 0||u===void 0)&&er.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,a,n.tokenAccount,u,r,s)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ne.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:a,nft2022:s,getEphemeralSigners:u}){let c=[],l;if(u)l=new B((await u(1))[0]);else{let y=pn.generate();c.push(y),l=y.publicKey}let m=s?re(o,a,be).publicKey:re(o,a,ie).publicKey,{publicKey:d}=Oe(n,a),p=qn(e,l).publicKey,g=re(o,l,ie).publicKey,f=Bt(l).publicKey,b=At.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:m,positionId:d,lockPositionId:p,lockNftMint:l,lockNftAccount:g,metadataAccount:f,withMetadata:!0,nft2022:s,positionNftMint:a,authPositionNftAccount:re(t,a,s?be:ie).publicKey,positionNftProgram:s?be:ie});return{address:{positionId:d,lockPositionId:p,lockNftAccount:g,lockNftMint:l,positionNftAccount:m,metadataAccount:f},instructions:[b],signers:c,instructionTypes:[ne.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:a,positionId:s,positionNftMint:u,authPositionNftAccount:c,positionNftProgram:l,lockPositionId:m,lockNftMint:d,lockNftAccount:p,metadataAccount:g,withMetadata:f}){let b=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!0,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:_t,isSigner:!1,isWritable:!1},{pubkey:He,isSigner:!1,isWritable:!1},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1}],y=M([Ie("withMetadata")]),h=Buffer.alloc(y.span);y.encode({withMetadata:f},h);let T=Buffer.from([...tr,...h]);return new Ke({keys:b,programId:e,data:T})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:a}=re(r,o,ie),{publicKey:s}=Oe(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:Dn(e,s).publicKey,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:at.programId,isSigner:!1,isWritable:!1}];return new Ke({keys:u,programId:e,data:Buffer.from(tr)})}static harvestLockPositionInstruction(e){let[t,n]=[new B(e.poolKeys.programId),new B(e.poolKeys.id)],r=E.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=E.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:a}=$(t,n,r),{publicKey:s}=$(t,n,o),{publicKey:u}=re(e.owner,e.ownerPosition.nftMint,ie),{publicKey:c}=Oe(t,e.ownerPosition.nftMint),{publicKey:l}=ot(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new B(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new B(e.poolKeys.rewardInfos[g].mint.address)});let d=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Dn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new B(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new B(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:new B(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new B(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ke({keys:p,programId:e.programId,data:Buffer.from(nr)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:a,lockNftAccount:s,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:g,tickArrayUpper:f,userVaultA:b,userVaultB:y,mintA:h,mintB:T,rewardAccounts:N,exTickArrayBitmap:v}){let I=[...v?[{pubkey:v,isSigner:!1,isWritable:!0}]:[],...N.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],L=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:ie,isSigner:!1,isWritable:!1},{pubkey:be,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},...I];return new Ke({keys:L,programId:e,data:Buffer.from(nr)})}};var Lf=M([Pe(8),_("bump"),Ie("disableCreatePool"),yt("index"),k("tradeFeeRate"),k("protocolFeeRate"),k("fundFeeRate"),k("createPoolFee"),S("protocolOwner"),S("fundOwner"),H(k(),16)]),Os=M([Pe(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),_("bump"),_("status"),_("lpDecimals"),_("mintDecimalA"),_("mintDecimalB"),k("lpAmount"),k("protocolFeesMintA"),k("protocolFeesMintB"),k("fundFeesMintA"),k("fundFeesMintB"),k("openTime"),H(k(),32)]);import{PublicKey as zf,TransactionInstruction as Es,Keypair as Hf,SystemProgram as Zf}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Yf,TOKEN_2022_PROGRAM_ID as Jf,TOKEN_PROGRAM_ID as $f}from"@solana/spl-token";var Of=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Ef=Buffer.from("amm_config","utf8"),vf=Buffer.from("pool","utf8"),Ff=Buffer.from("pool_lp_mint","utf8"),Wf=Buffer.from("pool_vault","utf8"),Vf=Buffer.from("observation","utf8");var _f=Buffer.from("locked_liquidity","utf8");var ob=ae("Raydium_cpmm"),vs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function rr(i,e,t,n,r,o,a,s,u,c,l,m,d,p,g,f){let b=M([k("amountIn"),k("amounOutMin")]),y=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],h=Buffer.alloc(b.span);return b.encode({amountIn:g,amounOutMin:f},h),new Es({keys:y,programId:i,data:Buffer.from([...vs.swapBaseInput,...h])})}import Tb from"bn.js";import Ib from"decimal.js-light";import Fs from"bn.js";var mb=new Fs(0);import or from"bn.js";var Vb=new or(25),_b=new or(1e4);var Qn=M([_("instruction"),k("amountIn"),k("minAmountOut")]),Hn=M([_("instruction"),k("maxAmountIn"),k("amountOut")]),Ub=M([_("instruction"),_("nonce")]),Ws=M([_("instruction"),_("nonce"),k("startTime")]),sr=M([k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalValue"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),k("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),k("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),k("lpReserve"),H(k(),3,"padding")]),Xb=M([k("accountType"),k("status"),k("nonce"),k("maxOrder"),k("depth"),k("baseDecimal"),k("quoteDecimal"),k("state"),k("resetFlag"),k("minSize"),k("volMaxCutRatio"),k("amountWaveRatio"),k("baseLotSize"),k("quoteLotSize"),k("minPriceMultiplier"),k("maxPriceMultiplier"),k("systemDecimalsValue"),k("abortTradeFactor"),k("priceTickMultiplier"),k("priceTick"),k("minSeparateNumerator"),k("minSeparateDenominator"),k("tradeFeeNumerator"),k("tradeFeeDenominator"),k("pnlNumerator"),k("pnlDenominator"),k("swapFeeNumerator"),k("swapFeeDenominator"),k("baseNeedTakePnl"),k("quoteNeedTakePnl"),k("quoteTotalPnl"),k("baseTotalPnl"),k("poolOpenTime"),k("punishPcAmount"),k("punishCoinAmount"),k("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),k("swapQuote2BaseFee"),k("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),H(k(),64,"padding")]),Vs=M([_("instruction"),k("baseAmountIn"),k("quoteAmountIn"),k("fixedSide"),k("otherAmountMin")]),_s=M([_("instruction"),k("lpAmount"),k("baseAmountMin"),k("quoteAmountMin")]);var zb=M([k("fee")]);import{PublicKey as Bg}from"@solana/web3.js";import Sg from"bn.js";import{TOKEN_PROGRAM_ID as Ng}from"@solana/spl-token";import{PublicKey as ey,SystemProgram as ty,SYSVAR_RENT_PUBKEY as ny,TransactionInstruction as ur}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ry,TOKEN_PROGRAM_ID as cr}from"@solana/spl-token";import{PublicKey as Ds}from"@solana/web3.js";var Zn=new Ds("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),qs=5e4,Gs=M([k("x"),k("y"),k("price")]),Yb=M([k("accountType"),k("status"),k("multiplier"),k("validDataCount"),H(Gs,qs,"DataElement")]);var ar=ae("Raydium_liquidity_instruction");function Us({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=ve(i),a=Buffer.alloc(Qn.span);Qn.encode({instruction:9,amountIn:ue(t),minAmountOut:ue(n)},a);let s=[P({pubkey:cr,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders})];return r===4&&s.push(P({pubkey:o.targetOrders})),s.push(P({pubkey:o.vault.A}),P({pubkey:o.vault.B})),r===5&&s.push(P({pubkey:Zn})),s.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ur({programId:o.programId,keys:s,data:a})}function Xs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=ve(i),a=Buffer.alloc(Hn.span);Hn.encode({instruction:11,maxAmountIn:ue(t),amountOut:ue(n)},a);let s=[P({pubkey:cr,isWritable:!1}),P({pubkey:o.id}),P({pubkey:o.authority,isWritable:!1}),P({pubkey:o.openOrders}),P({pubkey:o.targetOrders}),P({pubkey:o.vault.A}),P({pubkey:o.vault.B})];return r===5&&s.push(P({pubkey:Zn})),s.push(P({pubkey:o.marketProgramId,isWritable:!1}),P({pubkey:o.marketId}),P({pubkey:o.marketBids}),P({pubkey:o.marketAsks}),P({pubkey:o.marketEventQueue}),P({pubkey:o.marketBaseVault}),P({pubkey:o.marketQuoteVault}),P({pubkey:o.marketAuthority,isWritable:!1}),P({pubkey:e.tokenAccountIn}),P({pubkey:e.tokenAccountOut}),P({pubkey:e.owner,isWritable:!1,isSigner:!0})),new ur({programId:o.programId,keys:s,data:a})}function lr(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:a}=i;if(t===4||t===5){let s={poolKeys:e,userKeys:n};if(a==="in")return Us(te(Y({},s),{amountIn:r,minAmountOut:o}),t);if(a==="out")return Xs(te(Y({},s),{maxAmountIn:r,amountOut:o}),t);ar.logWithError("invalid params","params",i)}throw ar.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as yy}from"@solana/web3.js";var ky=ae("Raydium_liquidity_serum");var jn=M([S("mint"),S("owner"),k("amount"),Fe("delegateOption"),S("delegate"),_("state"),Fe("isNativeOption"),k("isNative"),k("delegatedAmount"),Fe("closeAuthorityOption"),S("closeAuthority")]);import{Keypair as xy,PublicKey as Sy}from"@solana/web3.js";import Ny from"bn.js";import{TOKEN_PROGRAM_ID as My}from"@solana/spl-token";var Ey=ae("Raydium_Util");import{PublicKey as Dy,SystemProgram as Gy}from"@solana/web3.js";import zy from"bn.js";import{createCloseAccountInstruction as jy,createInitializeAccountInstruction as Yy,createTransferInstruction as Jy,TOKEN_PROGRAM_ID as $y}from"@solana/spl-token";var zs=M([Fe("mintAuthorityOption"),S("mintAuthority"),k("supply"),_("decimals"),_("isInitialized"),Fe("freezeAuthorityOption"),S("freezeAuthority")]);var Qs={[Ln.toBase58()]:3};var Hs=M([Pe(5),Pe(8),S("ownAddress"),k("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),k("baseDepositsTotal"),k("baseFeesAccrued"),S("quoteVault"),k("quoteDepositsTotal"),k("quoteFeesAccrued"),k("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),k("baseLotSize"),k("quoteLotSize"),k("feeRateBps"),k("referrerRebatesAccrued"),Pe(7)]);import{PublicKey as tP}from"@solana/web3.js";var sP=ae("Serum");import{PublicKey as A,SystemProgram as Dt,TransactionInstruction as qt}from"@solana/web3.js";import Je from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Yn,TOKEN_2022_PROGRAM_ID as Jn,TOKEN_PROGRAM_ID as bt}from"@solana/spl-token";function wP(i,e,t,n,r,o,a,s,u,c,l,m){let d=M([_("instruction"),k("amountIn"),k("amountOut")]),p=[{pubkey:Dt.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:new A(t.programId),isSigner:!1,isWritable:!1},{pubkey:new A(t.id),isSigner:!1,isWritable:!0},{pubkey:new A(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=ve(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=ve(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=ve(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:l},g),new qt({keys:p,programId:i,data:g})}function TP(i,e,t,n,r,o,a,s,u,c){let l=M([_("instruction")]),m=[{pubkey:Dt.programId,isSigner:!1,isWritable:!1},{pubkey:bt,isSigner:!1,isWritable:!1},{pubkey:new A(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new A(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new A(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=ve(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=ve(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new A("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=ve(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new qt({keys:m,programId:i,data:d})}function Zs(i,e,t,n,r,o,a,s,u,c,l,m,d,p,g){var I;let f=[],b=[P({pubkey:bt,isWritable:!1}),P({pubkey:Jn,isWritable:!1}),P({pubkey:Yn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})];b.push(P({pubkey:t})),b.push(P({pubkey:r}));let y=[u,c],h=[l,m],T=[o,a,s];for(let L=0;L<y.length;L++){let R=y[L],D=T[L]===R.mintA.address;if(b.push(P({pubkey:new A(R.programId),isWritable:!1})),L===y.length-1?b.push(P({pubkey:r})):b.push(P({pubkey:n})),b.push(P({pubkey:new A(T[L])})),b.push(P({pubkey:new A(T[L+1])})),R.version===6){let x=h[L];b.push(P({pubkey:new A(x.config.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(D?x.vault.A:x.vault.B)})),b.push(P({pubkey:new A(D?x.vault.B:x.vault.A)})),b.push(P({pubkey:new A(R.observationId)})),b.push(P({pubkey:dt})),b.push(P({pubkey:ke(new A(R.programId),new A(R.id)).publicKey})),f.push($n(R.sqrtPriceX64.toString(),D));for(let F of(I=g[L])!=null?I:[])b.push(P({pubkey:new A(F)}))}else if(R.version===5){let x=h[L];b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.authority),isWritable:!1})),b.push(P({pubkey:new A(x.marketProgramId)})),b.push(P({pubkey:new A(x.marketAuthority)})),b.push(P({pubkey:tn,isWritable:!1})),b.push(P({pubkey:new A(x.openOrders)})),b.push(P({pubkey:new A(x.vault.A)})),b.push(P({pubkey:new A(x.vault.B)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.marketId)})),b.push(P({pubkey:new A(x.marketBids)})),b.push(P({pubkey:new A(x.marketAsks)})),b.push(P({pubkey:new A(x.marketEventQueue)})),b.push(P({pubkey:new A(x.marketBaseVault)})),b.push(P({pubkey:new A(x.marketQuoteVault)}))}else if(R.version===4){let x=h[L],F=R.status!==1;b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(x.authority),isWritable:!1})),b.push(P({pubkey:new A(F?x.id:x.marketProgramId)})),b.push(P({pubkey:new A(F?x.id:x.marketAuthority)})),b.push(P({pubkey:new A(F?x.id:x.openOrders)})),b.push(P({pubkey:new A(x.vault.A)})),b.push(P({pubkey:new A(x.vault.B)})),b.push(P({pubkey:new A(F?x.id:x.marketId)})),b.push(P({pubkey:new A(F?x.id:x.marketBids)})),b.push(P({pubkey:new A(F?x.id:x.marketAsks)})),b.push(P({pubkey:new A(F?x.id:x.marketEventQueue)})),b.push(P({pubkey:new A(F?x.id:x.marketBaseVault)})),b.push(P({pubkey:new A(F?x.id:x.marketQuoteVault)}))}else if(R.version===7){let x=h[L];b.push(P({pubkey:new A(x.authority)})),b.push(P({pubkey:new A(x.config.id)})),b.push(P({pubkey:new A(x.id)})),b.push(P({pubkey:new A(D?x.vault.A:x.vault.B)})),b.push(P({pubkey:new A(D?x.vault.B:x.vault.A)})),b.push(P({pubkey:new A(R.observationId)}))}else throw Error("pool type error")}let N=M([_("insId"),k("amountIn"),k("amountOut"),H(q(),f.length,"clmmPriceLimit")]),v=Buffer.alloc(N.span);return N.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},v),new qt({keys:b,programId:i,data:v})}function $n(i,e){if(i)if(e){let t=new Je(i).div(new Je(25));return t.gt(sn)?t:sn}else{let t=new Je(i).mul(new Je(25));return t.lt(an)?t:an}else return e?sn:an}function js({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,a,s,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=ve(m),p=t.equals(d.mintA.address)?Ze.add(We):je.sub(We);return At.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Je(0)),sqrtPriceLimitX64:p,remainingAccounts:(a=n.remainingAccounts[0])!=null?a:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[rr(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new A(m[d?"mintA":"mintB"].address),new A(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?ne.CpmmSwapBaseIn:ne.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[lr({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(s=n.minAmountOut.fee)==null?void 0:s.raw)!=null?u:new Je(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ne.AmmV5SwapBaseIn:ne.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Zs(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new Je(0)),n.remainingAccounts)],instructionTypes:[ne.RouteSwap],lookupTableAddress:[p.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}function hP({programId:i,wallet:e,amount:t,inputAccount:n,outputAccount:r,routeInfo:o,poolKeys:a}){var d;if(o.success===!1)throw Error("route info error");let s=[],u=[P({pubkey:bt,isWritable:!1}),P({pubkey:Jn,isWritable:!1}),P({pubkey:Yn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})],c={[o.data.inputMint]:n,[o.data.outputMint]:r};u.push(P({pubkey:c[o.data.inputMint]})),u.push(P({pubkey:c[o.data.outputMint]}));for(let p=0;p<a.length;p++){let g=o.data.routePlan[p],f=a[p],b=g.inputMint===f.mintA.address;if(u.push(P({pubkey:new A(f.programId),isWritable:!1})),p===a.length-1)u.push(P({pubkey:c[g.outputMint]}));else{let y=g.outputMint;if(c[y]===void 0){let h=re(e,new A(y),f.programId===Le.CLMM_PROGRAM_ID.toBase58()||f.programId===Le.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(b?f.mintB.programId:f.mintA.programId):bt).publicKey;c[y]=h}u.push(P({pubkey:c[y]}))}if(u.push(P({pubkey:new A(g.inputMint)})),u.push(P({pubkey:new A(g.outputMint)})),f.programId===Le.CLMM_PROGRAM_ID.toBase58()){let y=f;u.push(P({pubkey:new A(y.config.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(b?y.vault.A:y.vault.B)})),u.push(P({pubkey:new A(b?y.vault.B:y.vault.A)})),u.push(P({pubkey:new A(y.observationId)})),u.push(P({pubkey:dt,isWritable:!1})),u.push(P({pubkey:new A(y.exBitmapAccount)})),s.push($n(g.lastPoolPriceX64,b));for(let h of(d=g.remainingAccounts)!=null?d:[])u.push(P({pubkey:new A(h)}))}else if(f.programId===Le.AMM_STABLE.toBase58()){let y=f;u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.authority),isWritable:!1})),u.push(P({pubkey:new A(y.marketProgramId),isWritable:!1})),u.push(P({pubkey:new A(y.marketAuthority),isWritable:!1})),u.push(P({pubkey:tn,isWritable:!1})),u.push(P({pubkey:new A(y.openOrders)})),u.push(P({pubkey:new A(y.vault.A)})),u.push(P({pubkey:new A(y.vault.B)})),u.push(P({pubkey:new A(y.marketId)})),u.push(P({pubkey:new A(y.marketBids)})),u.push(P({pubkey:new A(y.marketAsks)})),u.push(P({pubkey:new A(y.marketEventQueue)})),u.push(P({pubkey:new A(y.marketBaseVault)})),u.push(P({pubkey:new A(y.marketQuoteVault)}))}else if(f.programId===Le.AMM_V4.toBase58()){let y=f;u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.authority),isWritable:!1})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.vault.A)})),u.push(P({pubkey:new A(y.vault.B)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(y.id)}))}else if(f.programId===Le.CREATE_CPMM_POOL_PROGRAM.toBase58()){let y=f;u.push(P({pubkey:new A(y.authority)})),u.push(P({pubkey:new A(y.config.id)})),u.push(P({pubkey:new A(y.id)})),u.push(P({pubkey:new A(b?y.vault.A:y.vault.B)})),u.push(P({pubkey:new A(b?y.vault.B:y.vault.A)})),u.push(P({pubkey:new A(y.observationId)}))}else throw Error("pool type error")}let l=M([_("insId"),k("amountIn"),k("amountOut"),H(q(),s.length,"clmmPriceLimit")]),m=Buffer.alloc(l.span);return l.encode({insId:0,amountIn:t,amountOut:new Je(o.data.otherAmountThreshold),clmmPriceLimit:s},m),new qt({keys:u,programId:i,data:m})}function IP({programId:i,wallet:e,inputAccount:t,outputAccount:n,routeInfo:r,poolKeys:o}){var m;if(r.success===!1)throw Error("route info error");let a=[],s=[P({pubkey:bt,isWritable:!1}),P({pubkey:Jn,isWritable:!1}),P({pubkey:Yn,isWritable:!1}),P({pubkey:Dt.programId,isWritable:!1}),P({pubkey:e,isSigner:!0})],u={[r.data.inputMint]:t,[r.data.outputMint]:n};for(let d=o.length-1;d>=0;d--){let p=r.data.routePlan[d],g=o[d],f=p.inputMint===g.mintA.address;if(s.push(P({pubkey:new A(g.programId)})),d===0)s.push(P({pubkey:u[p.inputMint]}));else{let b=p.inputMint;if(u[b]===void 0){let y=re(e,new A(b),g.programId===Le.CLMM_PROGRAM_ID.toBase58()||g.programId===Le.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(f?g.mintA.programId:g.mintB.programId):bt).publicKey;u[b]=y}s.push(P({pubkey:u[b]}))}if(d===o.length-1)s.push(P({pubkey:u[p.outputMint]}));else{let b=p.outputMint;if(u[b]===void 0){let y=re(e,new A(b),g.programId===Le.CLMM_PROGRAM_ID.toBase58()||g.programId===Le.CREATE_CPMM_POOL_PROGRAM.toBase58()?new A(f?g.mintB.programId:g.mintA.programId):bt).publicKey;u[b]=y}s.push(P({pubkey:u[b]}))}if(s.push(P({pubkey:new A(p.inputMint)})),s.push(P({pubkey:new A(p.outputMint)})),g.programId===Le.CLMM_PROGRAM_ID.toBase58()){let b=g;s.push(P({pubkey:new A(b.config.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(f?b.vault.A:b.vault.B)})),s.push(P({pubkey:new A(f?b.vault.B:b.vault.A)})),s.push(P({pubkey:new A(b.observationId)})),s.push(P({pubkey:dt,isWritable:!1})),s.push(P({pubkey:new A(b.exBitmapAccount)})),a.push($n(p.lastPoolPriceX64,f));for(let y of(m=p.remainingAccounts)!=null?m:[])s.push(P({pubkey:new A(y)}))}else if(g.programId===Le.AMM_STABLE.toBase58()){let b=g;s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.authority),isWritable:!1})),s.push(P({pubkey:new A(b.marketProgramId),isWritable:!1})),s.push(P({pubkey:new A(b.marketAuthority),isWritable:!1})),s.push(P({pubkey:tn,isWritable:!1})),s.push(P({pubkey:new A(b.openOrders)})),s.push(P({pubkey:new A(b.vault.A)})),s.push(P({pubkey:new A(b.vault.B)})),s.push(P({pubkey:new A(b.marketId)})),s.push(P({pubkey:new A(b.marketBids)})),s.push(P({pubkey:new A(b.marketAsks)})),s.push(P({pubkey:new A(b.marketEventQueue)})),s.push(P({pubkey:new A(b.marketBaseVault)})),s.push(P({pubkey:new A(b.marketQuoteVault)}))}else if(g.programId===Le.AMM_V4.toBase58()){let b=g;s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.authority),isWritable:!1})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.vault.A)})),s.push(P({pubkey:new A(b.vault.B)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(b.id)}))}else if(g.programId===Le.CREATE_CPMM_POOL_PROGRAM.toBase58()){let b=g;s.push(P({pubkey:new A(b.authority)})),s.push(P({pubkey:new A(b.config.id)})),s.push(P({pubkey:new A(b.id)})),s.push(P({pubkey:new A(f?b.vault.A:b.vault.B)})),s.push(P({pubkey:new A(f?b.vault.B:b.vault.A)})),s.push(P({pubkey:new A(b.observationId)}))}else throw Error("pool type error")}let c=M([_("insId"),k("amountIn"),k("amountOut"),H(q(),a.length,"clmmPriceLimit")]),l=Buffer.alloc(c.span);return c.encode({insId:1,amountIn:new Je(r.data.otherAmountThreshold),amountOut:new Je(r.data.outputAmount),clmmPriceLimit:a},l),new qt({keys:s,programId:i,data:l})}var uk=new Ys(0);export{js as makeSwapInstruction,wP as route1Instruction,TP as route2Instruction,Zs as routeInstruction,hP as swapBaseInAutoAccount,IP as swapBaseOutAutoAccount};
//# sourceMappingURL=index.mjs.map